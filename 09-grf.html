
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Causal Forests &#8212; è®¡ç®—ä¼ æ’­å­¦</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="ç¬¬ä¸ƒç«  ç¥ç»ç½‘ç»œä¸æ·±åº¦å­¦ä¹ " href="09-11-neural-network-intro.html" />
    <link rel="prev" title="The future of employment" href="09-10-future-employment.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/socrates_jump.gif" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">è®¡ç®—ä¼ æ’­å­¦</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="index.html">
                    å¯»æ‰¾äººç±»ä¼ æ’­è¡Œä¸ºçš„åŸºå› 
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="01-intro2cjc.html">
   ç¬¬ä¸€ç«  è®¡ç®—ä¼ æ’­å­¦ç®€ä»‹
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="02-bigdata.html">
     æ•°æ®ç§‘å­¦çš„ç¼–ç¨‹å·¥å…·ï¼šå¤§æ•°æ®
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="03-python-intro.html">
   ç¬¬äºŒç«  æ•°æ®ç§‘å­¦çš„ç¼–ç¨‹å·¥å…·
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="0-jupyter-notebook.html">
     Jupyter Notebook
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01-recombination.html">
     è®¡ç®—æ€ç»´ï¼šé€šè¿‡æ‹†è§£å’Œé‡ç»„å­¦ä¹ 
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="0-slides.html">
     ä½¿ç”¨Jupyteråˆ¶ä½œSlidesçš„ä»‹ç»
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="0-turicreate.html">
     Turicreate: Departure from Graphlab
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="0-matplotlib-chinese.html">
     è§£å†³Matplotlibç»˜å›¾æ˜¾ç¤ºä¸­æ–‡é—®é¢˜
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03-UK-MPS-Scandal.html">
     æ¡ˆä¾‹ï¼š2009å¹´è‹±å›½å›½ä¼šè®®å‘˜å¼€æ”¯ä¸‘é—»
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03-umbrella-of-love.html">
     æ¡ˆä¾‹ï¼šã€Šè½¬è§’é‡åˆ°çˆ±ã€‹èƒŒåçš„æ•°æ®
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03-who-runs-China.html">
     æ¡ˆä¾‹ï¼šWho runs Chinaï¼ŸèƒŒåçš„æ•°æ®
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03-gdelt.html">
     Gdelt Dataset: Events, Mentions, and Global Knowledge Graph
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="04-crawler-beautifulsoup.html">
   ç¬¬ä¸‰ç«  æ•°æ®æŠ“å–
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="04-crawler-fact-checking.html">
     æŠ“å–å®æ—¶è¾Ÿè°£æ•°æ®
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04-crawler-13chambers.html">
     æŠ“å–ç½‘ç»œå°è¯´
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04-crawler-wechat.html">
     æŠ“å–å¾®ä¿¡å…¬ä¼—å·æ–‡ç« å†…å®¹
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04-crawler-douban.html">
     ä½¿ç”¨requests + XpathæŠ“å–è±†ç“£ç”µå½±æ•°æ®
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04-crawler-gov-report.html">
     æŠ“å–å†å±Šæ”¿åºœå·¥ä½œæŠ¥å‘Š
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04-crawler-cppcc.html">
     æŠ“å–æ±Ÿè‹çœæ”¿ååå¹´ææ¡ˆ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04-crawler-netease-music.html">
     æŠ“å–ç½‘æ˜“äº‘éŸ³ä¹çƒ­é—¨è¯„è®º
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04-crawler-selenium.html">
     ä½¿ç”¨Seleniumæ“çºµæµè§ˆå™¨
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04-crawler-selenium-music-history.html">
     æŠ“å–ç½‘æ˜“äº‘éŸ³ä¹ç”¨æˆ·çš„å¬æ­Œè®°å½•
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04-crawler-selenium-people-com-search.html">
     ä½¿ç”¨Seleniumæå–äººæ°‘ç½‘æœç´¢æ•°æ®
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04-crawler-tripadvisor.html">
     ä½¿ç”¨SeleniumæŠ“å–TripAdvisorç”¨æˆ·è¯„è®º
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04-crawler-pyppeteer.html">
     ä½¿ç”¨Pyppeteerå®ç°å¼‚æ­¥æŠ“å–!
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04-crawler-weibo.html">
     è½»å‹å¾®åšçˆ¬è™«
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="06-data-cleaning-intro.html">
   ç¬¬å››ç«  æ•°æ®æ¸…æ´—
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="06-data-cleaning-preprocessing.html">
     å¯¹å¤§æ•°æ®è¿›è¡Œé¢„å¤„ç†
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06-data-cleaning-tweets.html">
     æ•°æ®æ¸…æ´—ä¹‹æ¨ç‰¹æ•°æ®
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06-data-cleaning-occupy-central-news.html">
     å¯¹å ä¸­æ–°é—»è¿›è¡Œæ•°æ®æ¸…æ´—
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06-data-cleaning-music-list.html">
     æ¸…æ´—éŸ³ä¹åˆ—è¡¨ğŸµ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06-data-cleaning-pandas.html">
     ä½¿ç”¨Pandasè¿›è¡Œæ•°æ®æ¸…æ´—
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="08-01-statistics-thinking.html">
   ç¬¬äº”ç«  ç»Ÿè®¡æ€ç»´
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="08-02-kl-divergence.html">
     KL Divergence
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-02-linear-algebra.html">
     Linear algebra
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-03-distributions.html">
     Distribution Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-03-probability.html">
     Probability
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-04-hypothesis-inference.html">
     Statistical Hypothesis Testing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-05-gradient-descent.html">
     Introduction to Gradient Descent
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-06-regression.html">
     Linear Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-06-statsmodels.html">
     Statistical Modeling with Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-07-analyzing-titanic-dataset.html">
     Logistic Regression of Titanic Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-07-covid19-pew-survey.html">
     Analysing the Pew Survey Data of COVID19
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-11-cfps-survey-analysis.html">
     ä¸­å›½å®¶åº­è¿½è¸ªè°ƒæŸ¥2018
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-08-covid19-grangercausality.html">
     ç¤¾äº¤åª’ä½“å¯ä»¥é¢„æµ‹æ–°å† ç–«æƒ…å—ï¼Ÿ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-09-survival-analysis.html">
     Survival Analysis with Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-10-dowhy-estimation-methods.html">
     The Book of Why
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="09-01-machine-learning-with-sklearn.html">
   ç¬¬å…­ç«  ç¤¾ä¼šç§‘å­¦å®¶çš„æœºå™¨å­¦ä¹ 
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="09-03-hyperparameters-and-model-validation.html">
     Hyperparameters and Model Validation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09-04-feature-engineering.html">
     Feature Engineering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09-05-naive-bayes.html">
     In Depth: Naive Bayes Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09-06-linear-regression.html">
     In Depth: Linear Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09-07-support-vector-machines.html">
     In-Depth: Support Vector Machines
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09-08-random-forests.html">
     In-Depth: Decision Trees and Random Forests
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09-09-googleflustudy.html">
     Forecasting and nowcasting with Google Flu Trends
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09-10-future-employment.html">
     The future of employment
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Causal Forests
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="09-11-neural-network-intro.html">
   ç¬¬ä¸ƒç«  ç¥ç»ç½‘ç»œä¸æ·±åº¦å­¦ä¹ 
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="09-13-cnn.html">
     Convolutional Networks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09-14-rnn.html">
     Sequnce Modeling: Recurrent and Recursive Nets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09-12-hand-written-digits.html">
     Recognizing Hand-Written Digits with Neural Networks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09-15-cifar10.html">
     ä½¿ç”¨CNNå¯¹CIFAR10å›¾åƒè¿›è¡Œåˆ†ç±»
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09-16-pytorch_vgg_pretrained.html">
     VGG16é¢„è®­ç»ƒæ¨¡å‹
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="10-text-mining-gov-report.html">
   ç¬¬å…«ç«  æ–‡æœ¬æŒ–æ˜
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="10-word2vec.html">
     è¯å‘é‡æ¨¡å‹ç®€ä»‹
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="10-doc2vec.html">
     Doc2Vec
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="11-1-sentiment-analysis-with-dict.html">
     åŸºäºå­—å…¸çš„æƒ…æ„Ÿåˆ†æ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="11-2-emotion-dict.html">
     å¤§è¿ç†å·¥å¤§å­¦ä¸­æ–‡æƒ…æ„Ÿè¯æ±‡
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="11-3-NRC-Chinese-dict.html">
     åŸºäºNRCå­—å…¸çš„æƒ…æ„Ÿåˆ†æ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="11-3-textblob.html">
     åˆ©ç”¨textblobè¿›è¡Œæƒ…æ„Ÿåˆ†æ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="11-4-sentiment-classifier.html">
     åŸºäºæœºå™¨å­¦ä¹ çš„æƒ…æ„Ÿåˆ†æ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="11-5-LIWC.html">
     LIWC: Linguistic Inquiry and Word Count  analyzer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="12-topic-models-update.html">
     ä¸»é¢˜æ¨¡å‹ç®€ä»‹
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="12-topic-models-with-turicreate.html">
     ä½¿ç”¨Turicreateå»ºç«‹ä¸»é¢˜æ¨¡å‹
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="13-recsys-intro.html">
   ç¬¬ä¹ç«  æ¨èç³»ç»Ÿç®€ä»‹
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="13-recsys-latent-factor-model.html">
     Latent Factor Recommender System
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="13-recsys-intro-surprise.html">
     ä½¿ç”¨Surpriseæ„å»ºæ¨èç³»ç»Ÿ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="14-millionsong.html">
     ä½¿ç”¨Turicreateè¿›è¡ŒéŸ³ä¹æ¨è
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="14-movielens.html">
     ä½¿ç”¨Turicreateè¿›è¡Œç”µå½±æ¨è
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="15-network-science-intro.html">
   ç¬¬åç«  ç½‘ç»œç§‘å­¦ç®€ä»‹
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="16-network-science-models.html">
     ç½‘ç»œç§‘å­¦æ¨¡å‹
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="17-networkx.html">
     ä½¿ç”¨NetworkXåˆ†æç½‘ç»œ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="18-02-network-diffusion.html">
     Simulating Network Diffusion With NDlib
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="18-03-network-epidemics.html">
     Epidemics on Networks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="18-04-seir-hcd-model.html">
     SEIR-HCD Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="18-network-ergm-siena.html">
     Social Network Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="18-network-weibo-hot-search.html">
     å¾®åšçƒ­æœåˆ†æ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="18-network-analysis-of-tianya-bbs.html">
     å¤©æ¶¯è®ºå›çš„å›å¸–ç½‘ç»œåˆ†æ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="19-facebook-ego-netwrok-visualization.html">
     å¯è§†åŒ–Facebookç¤¾äº¤ç½‘ç»œ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="18-network-ecomplexity.html">
     Economic Complexity and Product Complexity
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="19-visualization-with-seaborn.html">
   ç¬¬åä¸€ç«  å¯è§†åŒ–
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="19-visualization-matplotlib-colormap.html">
     Qualitative Colormaps in Matplotlib Visualization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="19-visualization-scientific-plot.html">
     Matplotlibçš„ç§‘å­¦ç»˜å›¾æ ·å¼
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="19-visualization-with-pyecharts.html">
     ä½¿ç”¨PyEchartsè¿›è¡Œå¯è§†åŒ–
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="19-visualization-plotly-express.html">
     Plotly Express in Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="19-visualization-maps-using-folium.html">
     ä½¿ç”¨foliumåšåœ°å›¾å¯è§†åŒ–
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="19-visualization-datashader.html">
     ä½¿ç”¨Datashaderå¯è§†åŒ–åœ°ç†ä¿¡æ¯
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="19-visualization-datapane.html">
     ä½¿ç”¨Datapaneåˆ¶ä½œæ•°æ®æŠ¥å‘Š
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="19-visualization-pantheon.html">
     ä¸‡ç¥æ®¿é¡¹ç›®ï¼ˆPantheon Projectï¼‰
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/chengjun/mybook/main?urlpath=tree/09-grf.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/chengjun/mybook/blob/main/09-grf.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/chengjun/mybook"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/chengjun/mybook/issues/new?title=Issue%20on%20page%20%2F09-grf.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/09-grf.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Causal Forests</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="causal-forests">
<h1>Causal Forests<a class="headerlink" href="#causal-forests" title="Permalink to this headline">#</a></h1>
<p><a class="reference external" href="https://github.com/grf-labs/grf/blob/master/experiments/acic18/script.R">https://github.com/grf-labs/grf/blob/master/experiments/acic18/script.R</a></p>
<p><a class="reference external" href="https://github.com/grf-labs/grf/tree/master/experiments/acic18">https://github.com/grf-labs/grf/tree/master/experiments/acic18</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">install.packages</span><span class="p">(</span><span class="s">&#39;grf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The downloaded binary packages are in
	/var/folders/8b/hhnbt0nd4zsg2qhxc28q23w80000gn/T//RtmpydKe1A/downloaded_packages
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="s">&#39;grf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning message:
â€œpackage â€˜grfâ€™ was built under R version 3.6.2â€
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">if</span><span class="p">(</span><span class="nf">packageVersion</span><span class="p">(</span><span class="s">&quot;grf&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="s">&#39;0.10.2&#39;</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">warning</span><span class="p">(</span><span class="s">&quot;This script requires grf 0.10.2 or higher&quot;</span><span class="p">)</span>
<span class="p">}</span>
<span class="nf">library</span><span class="p">(</span><span class="n">sandwich</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">lmtest</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">Hmisc</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">set.seed</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>

<span class="nf">rm</span><span class="p">(</span><span class="n">list</span> <span class="o">=</span> <span class="nf">ls</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">data.all</span> <span class="o">=</span> <span class="nf">read.csv</span><span class="p">(</span><span class="s">&quot;./data/synthetic_data.csv&quot;</span><span class="p">)</span>
<span class="n">data.all</span><span class="o">$</span><span class="n">schoolid</span> <span class="o">=</span> <span class="nf">factor</span><span class="p">(</span><span class="n">data.all</span><span class="o">$</span><span class="n">schoolid</span><span class="p">)</span>

<span class="n">DF</span> <span class="o">=</span> <span class="n">data.all</span><span class="p">[,</span><span class="m">-1</span><span class="p">]</span>
<span class="n">school.id</span> <span class="o">=</span> <span class="nf">as.numeric</span><span class="p">(</span><span class="n">data.all</span><span class="o">$</span><span class="n">schoolid</span><span class="p">)</span>

<span class="n">school.mat</span> <span class="o">=</span> <span class="nf">model.matrix</span><span class="p">(</span><span class="o">~</span> <span class="n">schoolid</span> <span class="o">+</span> <span class="m">0</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data.all</span><span class="p">)</span>
<span class="n">school.size</span> <span class="o">=</span> <span class="nf">colSums</span><span class="p">(</span><span class="n">school.mat</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># It appears that school ID does not affect pscore. So ignore it</span>
<span class="c1"># in modeling, and just treat it as source of per-cluster error.</span>
<span class="n">w.lm</span> <span class="o">=</span> <span class="nf">glm</span><span class="p">(</span><span class="n">Z</span> <span class="o">~</span> <span class="n">.</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data.all</span><span class="p">[,</span><span class="m">-3</span><span class="p">],</span> <span class="n">family</span> <span class="o">=</span> <span class="n">binomial</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">w.lm</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
glm(formula = Z ~ ., family = binomial, data = data.all[, -3])

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.2079  -0.9088  -0.8297   1.4176   1.9556  

Coefficients: (6 not defined because of singularities)
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -0.9524636  0.2845173  -3.348 0.000815 ***
schoolid2    0.0697302  0.2766287   0.252 0.800986    
schoolid3    0.0382080  0.2911323   0.131 0.895586    
schoolid4    0.1761334  0.2784711   0.633 0.527059    
schoolid5   -0.0033389  0.2950180  -0.011 0.990970    
schoolid6    0.0583548  0.3067481   0.190 0.849124    
schoolid7   -0.1313759  0.3188190  -0.412 0.680288    
schoolid8    0.1233661  0.3023736   0.408 0.683279    
schoolid9   -0.1955428  0.3073344  -0.636 0.524611    
schoolid10  -0.1892794  0.2968750  -0.638 0.523752    
schoolid11  -0.2224060  0.5461005  -0.407 0.683816    
schoolid12  -0.3312420  0.5414374  -0.612 0.540682    
schoolid13  -0.0408540  0.3989507  -0.102 0.918436    
schoolid14  -0.8681934  0.6033674  -1.439 0.150175    
schoolid15  -0.1059135  0.3263162  -0.325 0.745504    
schoolid16  -0.1063268  0.2885387  -0.369 0.712500    
schoolid17   0.0854323  0.3119435   0.274 0.784184    
schoolid18  -0.1924441  0.2997822  -0.642 0.520908    
schoolid19  -0.0265326  0.3229712  -0.082 0.934526    
schoolid20  -0.2179554  0.3041336  -0.717 0.473594    
schoolid21  -0.2147440  0.2982822  -0.720 0.471565    
schoolid22  -0.5115966  0.4410779  -1.160 0.246098    
schoolid23   0.0039231  0.3475373   0.011 0.990994    
schoolid24  -0.0848314  0.3259572  -0.260 0.794668    
schoolid25   0.0521087  0.2754586   0.189 0.849959    
schoolid26   0.0241212  0.2876511   0.084 0.933171    
schoolid27  -0.2300630  0.3104796  -0.741 0.458698    
schoolid28  -0.3519010  0.2924774  -1.203 0.228909    
schoolid29  -0.2198764  0.3293288  -0.668 0.504357    
schoolid30  -0.3146292  0.3257994  -0.966 0.334187    
schoolid31   0.1398555  0.6137901   0.228 0.819759    
schoolid32   0.1555524  0.3916156   0.397 0.691215    
schoolid33  -0.0991693  0.3939370  -0.252 0.801243    
schoolid34  -0.0073688  0.2980808  -0.025 0.980278    
schoolid35  -0.3528987  0.3997273  -0.883 0.377318    
schoolid36  -0.3751465  0.3988972  -0.940 0.346982    
schoolid37  -0.0343169  0.3219646  -0.107 0.915117    
schoolid38  -0.1346432  0.3851869  -0.350 0.726674    
schoolid39  -0.4339936  0.3612869  -1.201 0.229657    
schoolid40  -0.3993958  0.3834495  -1.042 0.297604    
schoolid41  -0.1490784  0.3542105  -0.421 0.673846    
schoolid42  -0.1545715  0.3551857  -0.435 0.663428    
schoolid43  -0.5679567  0.4277455  -1.328 0.184247    
schoolid44  -0.1425896  0.3774795  -0.378 0.705623    
schoolid45  -0.1337888  0.3232493  -0.414 0.678957    
schoolid46  -0.2573249  0.3129119  -0.822 0.410874    
schoolid47   0.0027726  0.2770108   0.010 0.992014    
schoolid48  -0.3406079  0.3470361  -0.981 0.326358    
schoolid49  -0.3236117  0.3434541  -0.942 0.346077    
schoolid50  -0.1185119  0.4086074  -0.290 0.771787    
schoolid51   0.4087898  0.4506822   0.907 0.364382    
schoolid52  -0.3144014  0.4118342  -0.763 0.445214    
schoolid53  -0.2733677  0.4511280  -0.606 0.544538    
schoolid54  -0.0889588  0.3872532  -0.230 0.818311    
schoolid55  -0.1558106  0.4155020  -0.375 0.707665    
schoolid56   0.1050353  0.3149235   0.334 0.738737    
schoolid57  -0.0314901  0.2901719  -0.109 0.913581    
schoolid58  -0.0383183  0.2730077  -0.140 0.888379    
schoolid59  -0.0529637  0.2934895  -0.180 0.856790    
schoolid60  -0.1624792  0.3972885  -0.409 0.682561    
schoolid61  -0.0289549  0.3201953  -0.090 0.927946    
schoolid62   0.0993158  0.2669678   0.372 0.709882    
schoolid63   0.1684702  0.3282167   0.513 0.607749    
schoolid64  -0.0693060  0.2770896  -0.250 0.802493    
schoolid65  -0.0004197  0.4072922  -0.001 0.999178    
schoolid66  -0.2130911  0.2984091  -0.714 0.475171    
schoolid67   0.0358440  0.2921158   0.123 0.902341    
schoolid68  -0.0871303  0.3290814  -0.265 0.791188    
schoolid69  -0.2550387  0.2908992  -0.877 0.380636    
schoolid70  -0.0268947  0.4032160  -0.067 0.946820    
schoolid71   0.0037464  0.4268290   0.009 0.992997    
schoolid72  -0.1304085  0.2881512  -0.453 0.650859    
schoolid73  -0.2160697  0.2840030  -0.761 0.446776    
schoolid74  -0.0935320  0.2842612  -0.329 0.742129    
schoolid75  -0.1056241  0.3024204  -0.349 0.726892    
schoolid76  -0.1052261  0.2939262  -0.358 0.720342    
S3           0.1036077  0.0197345   5.250 1.52e-07 ***
C1          -0.0015919  0.0053900  -0.295 0.767728    
C2          -0.1038596  0.0424020  -2.449 0.014309 *  
C3          -0.1319218  0.0461833  -2.856 0.004284 ** 
XC                  NA         NA      NA       NA    
X1                  NA         NA      NA       NA    
X2                  NA         NA      NA       NA    
X3                  NA         NA      NA       NA    
X4                  NA         NA      NA       NA    
X5                  NA         NA      NA       NA    
---
Signif. codes:  0 â€˜***â€™ 0.001 â€˜**â€™ 0.01 â€˜*â€™ 0.05 â€˜.â€™ 0.1 â€˜ â€™ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 13115  on 10390  degrees of freedom
Residual deviance: 13009  on 10311  degrees of freedom
AIC: 13169

Number of Fisher Scoring iterations: 4
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">W</span> <span class="o">=</span> <span class="n">DF</span><span class="o">$</span><span class="n">Z</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">DF</span><span class="o">$</span><span class="n">Y</span>
<span class="n">X.raw</span> <span class="o">=</span> <span class="n">DF</span><span class="p">[,</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">)]</span>

<span class="n">C1.exp</span> <span class="o">=</span> <span class="nf">model.matrix</span><span class="p">(</span><span class="o">~</span> <span class="nf">factor</span><span class="p">(</span><span class="n">X.raw</span><span class="o">$</span><span class="n">C1</span><span class="p">)</span> <span class="o">+</span> <span class="m">0</span><span class="p">)</span>
<span class="n">XC.exp</span> <span class="o">=</span> <span class="nf">model.matrix</span><span class="p">(</span><span class="o">~</span> <span class="nf">factor</span><span class="p">(</span><span class="n">X.raw</span><span class="o">$</span><span class="n">XC</span><span class="p">)</span> <span class="o">+</span> <span class="m">0</span><span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="nf">cbind</span><span class="p">(</span><span class="n">X.raw</span><span class="p">[,</span><span class="o">-</span><span class="nf">which</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">X.raw</span><span class="p">)</span> <span class="o">%in%</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;C1&quot;</span><span class="p">,</span> <span class="s">&quot;XC&quot;</span><span class="p">))],</span> <span class="n">C1.exp</span><span class="p">,</span> <span class="n">XC.exp</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># Grow a forest. Add extra trees for the causal forest.</span>
<span class="c1">#</span>

<span class="n">Y.forest</span> <span class="o">=</span> <span class="nf">regression_forest</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">clusters</span> <span class="o">=</span> <span class="n">school.id</span><span class="p">,</span> <span class="n">equalize.cluster.weights</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
<span class="n">Y.hat</span> <span class="o">=</span> <span class="nf">predict</span><span class="p">(</span><span class="n">Y.forest</span><span class="p">)</span><span class="o">$</span><span class="n">predictions</span>
<span class="n">W.forest</span> <span class="o">=</span> <span class="nf">regression_forest</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">clusters</span> <span class="o">=</span> <span class="n">school.id</span><span class="p">,</span> <span class="n">equalize.cluster.weights</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
<span class="n">W.hat</span> <span class="o">=</span> <span class="nf">predict</span><span class="p">(</span><span class="n">W.forest</span><span class="p">)</span><span class="o">$</span><span class="n">predictions</span>

<span class="n">cf.raw</span> <span class="o">=</span> <span class="nf">causal_forest</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span>
                       <span class="n">Y.hat</span> <span class="o">=</span> <span class="n">Y.hat</span><span class="p">,</span> <span class="n">W.hat</span> <span class="o">=</span> <span class="n">W.hat</span><span class="p">,</span>
                       <span class="n">clusters</span> <span class="o">=</span> <span class="n">school.id</span><span class="p">,</span>
                       <span class="n">equalize.cluster.weights</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
<span class="n">varimp</span> <span class="o">=</span> <span class="nf">variable_importance</span><span class="p">(</span><span class="n">cf.raw</span><span class="p">)</span>
<span class="n">selected.idx</span> <span class="o">=</span> <span class="nf">which</span><span class="p">(</span><span class="n">varimp</span> <span class="o">&gt;</span> <span class="nf">mean</span><span class="p">(</span><span class="n">varimp</span><span class="p">))</span>

<span class="n">cf</span> <span class="o">=</span> <span class="nf">causal_forest</span><span class="p">(</span><span class="n">X</span><span class="p">[,</span><span class="n">selected.idx</span><span class="p">],</span> <span class="n">Y</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span>
                   <span class="n">Y.hat</span> <span class="o">=</span> <span class="n">Y.hat</span><span class="p">,</span> <span class="n">W.hat</span> <span class="o">=</span> <span class="n">W.hat</span><span class="p">,</span>
                   <span class="n">clusters</span> <span class="o">=</span> <span class="n">school.id</span><span class="p">,</span>
                   <span class="n">equalize.cluster.weights</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span>
                   <span class="n">tune.parameters</span> <span class="o">=</span> <span class="s">&quot;all&quot;</span><span class="p">)</span>
<span class="n">tau.hat</span> <span class="o">=</span> <span class="nf">predict</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span><span class="o">$</span><span class="n">predictions</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># Estimate ATE</span>
<span class="c1">#</span>

<span class="n">ATE</span> <span class="o">=</span> <span class="nf">average_treatment_effect</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span>
<span class="nf">paste</span><span class="p">(</span><span class="s">&quot;95% CI for the ATE:&quot;</span><span class="p">,</span> <span class="nf">round</span><span class="p">(</span><span class="n">ATE</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="m">3</span><span class="p">),</span>
      <span class="s">&quot;+/-&quot;</span><span class="p">,</span> <span class="nf">round</span><span class="p">(</span><span class="nf">qnorm</span><span class="p">(</span><span class="m">0.975</span><span class="p">)</span> <span class="o">*</span> <span class="n">ATE</span><span class="p">[</span><span class="m">2</span><span class="p">],</span> <span class="m">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">'95% CI for the ATE: 0.249 +/- 0.04'</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># Omnibus tests for heterogeneity</span>
<span class="c1">#</span>

<span class="c1"># Run best linear predictor analysis</span>
<span class="nf">test_calibration</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span>

<span class="c1"># Compare regions with high and low estimated CATEs</span>
<span class="n">high_effect</span> <span class="o">=</span> <span class="n">tau.hat</span> <span class="o">&gt;</span> <span class="nf">median</span><span class="p">(</span><span class="n">tau.hat</span><span class="p">)</span>
<span class="n">ate.high</span> <span class="o">=</span> <span class="nf">average_treatment_effect</span><span class="p">(</span><span class="n">cf</span><span class="p">,</span> <span class="n">subset</span> <span class="o">=</span> <span class="n">high_effect</span><span class="p">)</span>
<span class="n">ate.low</span> <span class="o">=</span> <span class="nf">average_treatment_effect</span><span class="p">(</span><span class="n">cf</span><span class="p">,</span> <span class="n">subset</span> <span class="o">=</span> <span class="o">!</span><span class="n">high_effect</span><span class="p">)</span>
<span class="nf">paste</span><span class="p">(</span><span class="s">&quot;95% CI for difference in ATE:&quot;</span><span class="p">,</span>
      <span class="nf">round</span><span class="p">(</span><span class="n">ate.high</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ate.low</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="m">3</span><span class="p">),</span> <span class="s">&quot;+/-&quot;</span><span class="p">,</span>
      <span class="nf">round</span><span class="p">(</span><span class="nf">qnorm</span><span class="p">(</span><span class="m">0.975</span><span class="p">)</span> <span class="o">*</span> <span class="nf">sqrt</span><span class="p">(</span><span class="n">ate.high</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="o">^</span><span class="m">2</span> <span class="o">+</span> <span class="n">ate.low</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="o">^</span><span class="m">2</span><span class="p">),</span> <span class="m">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best linear fit using forest predictions (on held-out data)
as well as the mean forest prediction as regressors, along
with one-sided heteroskedasticity-robust (HC3) SEs:

                                Estimate Std. Error t value Pr(&gt;t)    
mean.forest.prediction          1.008054   0.082129 12.2741 &lt;2e-16 ***
differential.forest.prediction -0.552783   1.063927 -0.5196 0.6983    
---
Signif. codes:  0 â€˜***â€™ 0.001 â€˜**â€™ 0.01 â€˜*â€™ 0.05 â€˜.â€™ 0.1 â€˜ â€™ 1
</pre></div>
</div>
<div class="output text_html">'95% CI for difference in ATE: 0.01 +/- 0.074'</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># formal test for X1 and X2</span>
<span class="c1">#</span>

<span class="n">dr.score</span> <span class="o">=</span> <span class="n">tau.hat</span> <span class="o">+</span> <span class="n">W</span> <span class="o">/</span> <span class="n">cf</span><span class="o">$</span><span class="n">W.hat</span> <span class="o">*</span>
  <span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">cf</span><span class="o">$</span><span class="n">Y.hat</span> <span class="o">-</span> <span class="p">(</span><span class="m">1</span> <span class="o">-</span> <span class="n">cf</span><span class="o">$</span><span class="n">W.hat</span><span class="p">)</span> <span class="o">*</span> <span class="n">tau.hat</span><span class="p">)</span> <span class="o">-</span>
  <span class="p">(</span><span class="m">1</span> <span class="o">-</span> <span class="n">W</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="m">1</span> <span class="o">-</span> <span class="n">cf</span><span class="o">$</span><span class="n">W.hat</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">cf</span><span class="o">$</span><span class="n">Y.hat</span> <span class="o">+</span> <span class="n">cf</span><span class="o">$</span><span class="n">W.hat</span> <span class="o">*</span> <span class="n">tau.hat</span><span class="p">)</span>
<span class="n">school.score</span> <span class="o">=</span> <span class="nf">t</span><span class="p">(</span><span class="n">school.mat</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">dr.score</span> <span class="o">/</span> <span class="n">school.size</span>

<span class="n">school.X1</span> <span class="o">=</span> <span class="nf">t</span><span class="p">(</span><span class="n">school.mat</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">X</span><span class="o">$</span><span class="n">X1</span> <span class="o">/</span> <span class="n">school.size</span>
<span class="n">high.X1</span> <span class="o">=</span> <span class="n">school.X1</span> <span class="o">&gt;</span> <span class="nf">median</span><span class="p">(</span><span class="n">school.X1</span><span class="p">)</span>
<span class="nf">t.test</span><span class="p">(</span><span class="n">school.score</span><span class="p">[</span><span class="n">high.X1</span><span class="p">],</span> <span class="n">school.score</span><span class="p">[</span><span class="o">!</span><span class="n">high.X1</span><span class="p">])</span>

<span class="n">school.X2</span> <span class="o">=</span> <span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">school.mat</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">X</span><span class="o">$</span><span class="n">X2</span><span class="p">)</span> <span class="o">/</span> <span class="n">school.size</span>
<span class="n">high.X2</span> <span class="o">=</span> <span class="n">school.X2</span> <span class="o">&gt;</span> <span class="nf">median</span><span class="p">(</span><span class="n">school.X2</span><span class="p">)</span>
<span class="nf">t.test</span><span class="p">(</span><span class="n">school.score</span><span class="p">[</span><span class="n">high.X2</span><span class="p">],</span> <span class="n">school.score</span><span class="p">[</span><span class="o">!</span><span class="n">high.X2</span><span class="p">])</span>

<span class="n">school.X2.levels</span> <span class="o">=</span> <span class="nf">cut</span><span class="p">(</span><span class="n">school.X2</span><span class="p">,</span>
  <span class="n">breaks</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="o">-</span><span class="kc">Inf</span><span class="p">,</span> <span class="nf">quantile</span><span class="p">(</span><span class="n">school.X2</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="m">3</span><span class="p">,</span> <span class="m">2</span><span class="o">/</span><span class="m">3</span><span class="p">)),</span> <span class="kc">Inf</span><span class="p">))</span>
<span class="nf">summary</span><span class="p">(</span><span class="nf">aov</span><span class="p">(</span><span class="n">school.score</span> <span class="o">~</span> <span class="n">school.X2.levels</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	Welch Two Sample t-test

data:  school.score[high.X1] and school.score[!high.X1]
t = -3.0347, df = 71.45, p-value = 0.003357
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -0.19218352 -0.03978437
sample estimates:
mean of x mean of y 
0.1908525 0.3068365 
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	Welch Two Sample t-test

data:  school.score[high.X2] and school.score[!high.X2]
t = 0.9637, df = 72.286, p-value = 0.3384
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -0.04146936  0.11909811
sample estimates:
mean of x mean of y 
0.2682517 0.2294373 
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                 Df Sum Sq Mean Sq F value Pr(&gt;F)
school.X2.levels  2 0.0811 0.04054   1.328  0.271
Residuals        73 2.2283 0.03052               
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># formal test for S3</span>
<span class="c1">#</span>

<span class="n">school.score.XS3.high</span> <span class="o">=</span> <span class="nf">t</span><span class="p">(</span><span class="n">school.mat</span><span class="p">)</span> <span class="o">%*%</span> <span class="p">(</span><span class="n">dr.score</span> <span class="o">*</span> <span class="p">(</span><span class="n">X</span><span class="o">$</span><span class="n">S3</span> <span class="o">&gt;=</span> <span class="m">6</span><span class="p">))</span> <span class="o">/</span>
  <span class="nf">t</span><span class="p">(</span><span class="n">school.mat</span><span class="p">)</span> <span class="o">%*%</span> <span class="p">(</span><span class="n">X</span><span class="o">$</span><span class="n">S3</span> <span class="o">&gt;=</span> <span class="m">6</span><span class="p">)</span>
<span class="n">school.score.XS3.low</span> <span class="o">=</span> <span class="nf">t</span><span class="p">(</span><span class="n">school.mat</span><span class="p">)</span> <span class="o">%*%</span> <span class="p">(</span><span class="n">dr.score</span> <span class="o">*</span> <span class="p">(</span><span class="n">X</span><span class="o">$</span><span class="n">S3</span> <span class="o">&lt;</span> <span class="m">6</span><span class="p">))</span> <span class="o">/</span>
  <span class="nf">t</span><span class="p">(</span><span class="n">school.mat</span><span class="p">)</span> <span class="o">%*%</span> <span class="p">(</span><span class="n">X</span><span class="o">$</span><span class="n">S3</span> <span class="o">&lt;</span> <span class="m">6</span><span class="p">)</span>

<span class="nf">plot</span><span class="p">(</span><span class="n">school.score.XS3.low</span><span class="p">,</span> <span class="n">school.score.XS3.high</span><span class="p">)</span>
<span class="nf">t.test</span><span class="p">(</span><span class="n">school.score.XS3.high</span> <span class="o">-</span> <span class="n">school.score.XS3.low</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	One Sample t-test

data:  school.score.XS3.high - school.score.XS3.low
t = 2.2397, df = 75, p-value = 0.02807
alternative hypothesis: true mean is not equal to 0
95 percent confidence interval:
 0.009408619 0.160803922
sample estimates:
 mean of x 
0.08510627 
</pre></div>
</div>
<img alt="_images/09-grf_12_1.png" src="_images/09-grf_12_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># Look at school-wise heterogeneity</span>
<span class="c1">#</span>

<span class="c1">#pdf(&quot;school_hist.pdf&quot;)</span>
<span class="n">pardef</span> <span class="o">=</span> <span class="nf">par</span><span class="p">(</span><span class="n">mar</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span> <span class="o">+</span> <span class="m">0.5</span><span class="p">,</span> <span class="n">cex.lab</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.axis</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.main</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.sub</span><span class="o">=</span><span class="m">1.5</span><span class="p">)</span>
<span class="nf">hist</span><span class="p">(</span><span class="n">school.score</span><span class="p">,</span> <span class="n">xlab</span> <span class="o">=</span> <span class="s">&quot;School Treatment Effect Estimate&quot;</span><span class="p">,</span> <span class="n">main</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="c1">#dev.off()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/09-grf_13_0.png" src="_images/09-grf_13_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># Re-check ATE... sanity check only</span>
<span class="c1">#</span>

<span class="n">ate.hat</span> <span class="o">=</span> <span class="nf">mean</span><span class="p">(</span><span class="n">school.score</span><span class="p">)</span>
<span class="n">se.hat</span> <span class="o">=</span> <span class="nf">sqrt</span><span class="p">(</span><span class="nf">var</span><span class="p">(</span><span class="n">school.score</span><span class="p">)</span> <span class="o">/</span> <span class="nf">length</span><span class="p">(</span><span class="n">school.score</span> <span class="o">-</span> <span class="m">1</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="n">ate.hat</span><span class="p">,</span> <span class="m">3</span><span class="p">),</span> <span class="s">&quot;+/-&quot;</span><span class="p">,</span> <span class="nf">round</span><span class="p">(</span><span class="m">1.96</span> <span class="o">*</span> <span class="n">se.hat</span><span class="p">,</span> <span class="m">3</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] &quot;0.249 +/- 0.039&quot;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># Look at variation in propensity scores</span>
<span class="c1">#</span>

<span class="n">DF</span> <span class="o">=</span> <span class="n">X</span>
<span class="n">DF</span><span class="o">$</span><span class="n">W.hat</span> <span class="o">=</span> <span class="n">cf</span><span class="o">$</span><span class="n">W.hat</span>

<span class="c1">#pdf(&quot;pscore.pdf&quot;)</span>
<span class="n">pardef</span> <span class="o">=</span> <span class="nf">par</span><span class="p">(</span><span class="n">mar</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span> <span class="o">+</span> <span class="m">0.5</span><span class="p">,</span> <span class="n">cex.lab</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.axis</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.main</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.sub</span><span class="o">=</span><span class="m">1.5</span><span class="p">)</span>
<span class="nf">boxplot</span><span class="p">(</span><span class="n">W.hat</span> <span class="o">~</span> <span class="n">S3</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">DF</span><span class="p">,</span> <span class="n">ylab</span> <span class="o">=</span> <span class="s">&quot;Propensity Score&quot;</span><span class="p">,</span> <span class="n">xlab</span> <span class="o">=</span> <span class="s">&quot;Student Expectation of Success&quot;</span><span class="p">)</span>
<span class="nf">lines</span><span class="p">(</span><span class="nf">smooth.spline</span><span class="p">(</span><span class="n">X</span><span class="o">$</span><span class="n">S3</span><span class="p">,</span> <span class="n">cf</span><span class="o">$</span><span class="n">W.hat</span><span class="p">),</span> <span class="n">lwd</span> <span class="o">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="m">4</span><span class="p">)</span>
<span class="c1">#dev.off()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/09-grf_15_0.png" src="_images/09-grf_15_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># Analysis ignoring clusters</span>
<span class="c1">#</span>

<span class="n">cf.noclust</span> <span class="o">=</span> <span class="nf">causal_forest</span><span class="p">(</span><span class="n">X</span><span class="p">[,</span><span class="n">selected.idx</span><span class="p">],</span> <span class="n">Y</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span>
                           <span class="n">Y.hat</span> <span class="o">=</span> <span class="n">Y.hat</span><span class="p">,</span> <span class="n">W.hat</span> <span class="o">=</span> <span class="n">W.hat</span><span class="p">,</span>
                           <span class="n">tune.parameters</span> <span class="o">=</span> <span class="s">&quot;all&quot;</span><span class="p">)</span>

<span class="n">ATE.noclust</span> <span class="o">=</span> <span class="nf">average_treatment_effect</span><span class="p">(</span><span class="n">cf.noclust</span><span class="p">)</span>
<span class="nf">paste</span><span class="p">(</span><span class="s">&quot;95% CI for the ATE:&quot;</span><span class="p">,</span> <span class="nf">round</span><span class="p">(</span><span class="n">ATE.noclust</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="m">3</span><span class="p">),</span>
      <span class="s">&quot;+/-&quot;</span><span class="p">,</span> <span class="nf">round</span><span class="p">(</span><span class="nf">qnorm</span><span class="p">(</span><span class="m">0.975</span><span class="p">)</span> <span class="o">*</span> <span class="n">ATE.noclust</span><span class="p">[</span><span class="m">2</span><span class="p">],</span> <span class="m">3</span><span class="p">))</span>

<span class="nf">test_calibration</span><span class="p">(</span><span class="n">cf.noclust</span><span class="p">)</span>

<span class="n">tau.hat.noclust</span> <span class="o">=</span> <span class="nf">predict</span><span class="p">(</span><span class="n">cf.noclust</span><span class="p">)</span><span class="o">$</span><span class="n">predict</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">school.id</span><span class="p">,</span> <span class="n">tau.hat.noclust</span><span class="p">)</span>

<span class="n">nfold</span> <span class="o">=</span> <span class="m">5</span>
<span class="n">school.levels</span> <span class="o">=</span> <span class="nf">unique</span><span class="p">(</span><span class="n">school.id</span><span class="p">)</span>
<span class="n">cluster.folds</span> <span class="o">=</span> <span class="nf">sample.int</span><span class="p">(</span><span class="n">nfold</span><span class="p">,</span> <span class="nf">length</span><span class="p">(</span><span class="n">school.levels</span><span class="p">),</span> <span class="n">replace</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>

<span class="n">tau.hat.crossfold</span> <span class="o">=</span> <span class="nf">rep</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span> <span class="nf">length</span><span class="p">(</span><span class="n">Y</span><span class="p">))</span>
<span class="nf">for </span><span class="p">(</span><span class="n">foldid</span> <span class="n">in</span> <span class="m">1</span><span class="o">:</span><span class="n">nfold</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="n">foldid</span><span class="p">)</span>
  <span class="n">infold</span> <span class="o">=</span> <span class="n">school.id</span> <span class="o">%in%</span> <span class="n">school.levels</span><span class="p">[</span><span class="n">cluster.folds</span> <span class="o">==</span> <span class="n">foldid</span><span class="p">]</span>
  <span class="n">cf.fold</span> <span class="o">=</span> <span class="nf">causal_forest</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="o">!</span><span class="n">infold</span><span class="p">,</span> <span class="n">selected.idx</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="o">!</span><span class="n">infold</span><span class="p">],</span> <span class="n">W</span><span class="p">[</span><span class="o">!</span><span class="n">infold</span><span class="p">],</span>
                          <span class="n">Y.hat</span> <span class="o">=</span> <span class="n">Y.hat</span><span class="p">[</span><span class="o">!</span><span class="n">infold</span><span class="p">],</span> <span class="n">W.hat</span> <span class="o">=</span> <span class="n">W.hat</span><span class="p">[</span><span class="o">!</span><span class="n">infold</span><span class="p">],</span>
                          <span class="n">tune.parameters</span> <span class="o">=</span> <span class="s">&quot;all&quot;</span><span class="p">)</span>
  <span class="n">pred.fold</span> <span class="o">=</span> <span class="nf">predict</span><span class="p">(</span><span class="n">cf.fold</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="n">infold</span><span class="p">,</span> <span class="n">selected.idx</span><span class="p">])</span><span class="o">$</span><span class="n">predictions</span>
  <span class="n">tau.hat.crossfold</span><span class="p">[</span><span class="n">infold</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred.fold</span>
<span class="p">}</span>

<span class="n">cf.noclust.cpy</span> <span class="o">=</span> <span class="n">cf.noclust</span>
<span class="n">cf.noclust.cpy</span><span class="o">$</span><span class="n">predictions</span> <span class="o">=</span> <span class="n">tau.hat.crossfold</span>
<span class="n">cf.noclust.cpy</span><span class="o">$</span><span class="n">clusters</span> <span class="o">=</span> <span class="n">school.id</span>
<span class="nf">test_calibration</span><span class="p">(</span><span class="n">cf.noclust.cpy</span><span class="p">)</span>

<span class="n">Rloss</span> <span class="o">=</span> <span class="nf">mean</span><span class="p">(((</span><span class="n">Y</span> <span class="o">-</span> <span class="n">Y.hat</span><span class="p">)</span> <span class="o">-</span> <span class="n">tau.hat</span> <span class="o">*</span> <span class="p">(</span><span class="n">W</span> <span class="o">-</span> <span class="n">W.hat</span><span class="p">))</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>
<span class="n">Rloss.noclust</span> <span class="o">=</span> <span class="nf">mean</span><span class="p">(((</span><span class="n">Y</span> <span class="o">-</span> <span class="n">Y.hat</span><span class="p">)</span> <span class="o">-</span> <span class="n">tau.hat.noclust</span> <span class="o">*</span> <span class="p">(</span><span class="n">W</span> <span class="o">-</span> <span class="n">W.hat</span><span class="p">))</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>
<span class="n">Rloss.crossfold</span> <span class="o">=</span> <span class="nf">mean</span><span class="p">(((</span><span class="n">Y</span> <span class="o">-</span> <span class="n">Y.hat</span><span class="p">)</span> <span class="o">-</span> <span class="n">tau.hat.crossfold</span> <span class="o">*</span> <span class="p">(</span><span class="n">W</span> <span class="o">-</span> <span class="n">W.hat</span><span class="p">))</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>

<span class="nf">c</span><span class="p">(</span><span class="n">Rloss.noclust</span> <span class="o">-</span> <span class="n">Rloss</span><span class="p">,</span> <span class="n">Rloss.crossfold</span> <span class="o">-</span> <span class="n">Rloss</span><span class="p">)</span>

<span class="nf">summary</span><span class="p">(</span><span class="nf">aov</span><span class="p">(</span><span class="n">dr.score</span> <span class="o">~</span> <span class="nf">factor</span><span class="p">(</span><span class="n">school.id</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">'95% CI for the ATE: 0.254 +/- 0.022'</div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best linear fit using forest predictions (on held-out data)
as well as the mean forest prediction as regressors, along
with one-sided heteroskedasticity-robust (HC3) SEs:

                               Estimate Std. Error t value    Pr(&gt;t)    
mean.forest.prediction         1.012757   0.045084 22.4639 &lt; 2.2e-16 ***
differential.forest.prediction 0.528275   0.133245  3.9647 3.699e-05 ***
---
Signif. codes:  0 â€˜***â€™ 0.001 â€˜**â€™ 0.01 â€˜*â€™ 0.05 â€˜.â€™ 0.1 â€˜ â€™ 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 1
[1] 2
[1] 3
[1] 4
[1] 5
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best linear fit using forest predictions (on held-out data)
as well as the mean forest prediction as regressors, along
with one-sided heteroskedasticity-robust (HC3) SEs:

                               Estimate Std. Error t value Pr(&gt;t)    
mean.forest.prediction         0.988134   0.064817 15.2450 &lt;2e-16 ***
differential.forest.prediction 0.224634   0.213643  1.0514 0.1465    
---
Signif. codes:  0 â€˜***â€™ 0.001 â€˜**â€™ 0.01 â€˜*â€™ 0.05 â€˜.â€™ 0.1 â€˜ â€™ 1
</pre></div>
</div>
<div class="output text_html"><ol class=list-inline>
	<li>-8.91498516542577e-05</li>
	<li>0.000504054002137821</li>
</ol>
</div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                     Df Sum Sq Mean Sq F value   Pr(&gt;F)    
factor(school.id)    75    201   2.677    1.98 1.05e-06 ***
Residuals         10315  13944   1.352                     
---
Signif. codes:  0 â€˜***â€™ 0.001 â€˜**â€™ 0.01 â€˜*â€™ 0.05 â€˜.â€™ 0.1 â€˜ â€™ 1
</pre></div>
</div>
<img alt="_images/09-grf_16_6.png" src="_images/09-grf_16_6.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># Analaysis without fitting the propensity score</span>
<span class="c1">#</span>

<span class="n">cf.noprop</span> <span class="o">=</span> <span class="nf">causal_forest</span><span class="p">(</span><span class="n">X</span><span class="p">[,</span><span class="n">selected.idx</span><span class="p">],</span> <span class="n">Y</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span>
                          <span class="n">Y.hat</span> <span class="o">=</span> <span class="n">Y.hat</span><span class="p">,</span> <span class="n">W.hat</span> <span class="o">=</span> <span class="nf">mean</span><span class="p">(</span><span class="n">W</span><span class="p">),</span>
                          <span class="n">tune.parameters</span> <span class="o">=</span> <span class="s">&quot;all&quot;</span><span class="p">,</span>
                          <span class="n">equalize.cluster.weights</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span>
                          <span class="n">clusters</span> <span class="o">=</span> <span class="n">school.id</span><span class="p">)</span>
<span class="n">tau.hat.noprop</span> <span class="o">=</span> <span class="nf">predict</span><span class="p">(</span><span class="n">cf.noprop</span><span class="p">)</span><span class="o">$</span><span class="n">predictions</span>

<span class="n">ATE.noprop</span> <span class="o">=</span> <span class="nf">average_treatment_effect</span><span class="p">(</span><span class="n">cf.noprop</span><span class="p">)</span>
<span class="nf">paste</span><span class="p">(</span><span class="s">&quot;95% CI for the ATE:&quot;</span><span class="p">,</span> <span class="nf">round</span><span class="p">(</span><span class="n">ATE.noprop</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="m">3</span><span class="p">),</span>
      <span class="s">&quot;+/-&quot;</span><span class="p">,</span> <span class="nf">round</span><span class="p">(</span><span class="nf">qnorm</span><span class="p">(</span><span class="m">0.975</span><span class="p">)</span> <span class="o">*</span> <span class="n">ATE.noprop</span><span class="p">[</span><span class="m">2</span><span class="p">],</span> <span class="m">3</span><span class="p">))</span>

<span class="c1">#pdf(&quot;tauhat_noprop.pdf&quot;)</span>
<span class="n">pardef</span> <span class="o">=</span> <span class="nf">par</span><span class="p">(</span><span class="n">mar</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span> <span class="o">+</span> <span class="m">0.5</span><span class="p">,</span> <span class="n">cex.lab</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.axis</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.main</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.sub</span><span class="o">=</span><span class="m">1.5</span><span class="p">)</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">tau.hat</span><span class="p">,</span> <span class="n">tau.hat.noprop</span><span class="p">,</span>
     <span class="n">xlim</span> <span class="o">=</span> <span class="nf">range</span><span class="p">(</span><span class="n">tau.hat</span><span class="p">,</span> <span class="n">tau.hat.noprop</span><span class="p">),</span>
     <span class="n">ylim</span> <span class="o">=</span> <span class="nf">range</span><span class="p">(</span><span class="n">tau.hat</span><span class="p">,</span> <span class="n">tau.hat.noprop</span><span class="p">),</span>
     <span class="n">xlab</span> <span class="o">=</span> <span class="s">&quot;orthogonalized causal forest estimates&quot;</span><span class="p">,</span>
     <span class="n">ylab</span> <span class="o">=</span> <span class="s">&quot;non-orthogonalized causal forest&quot;</span><span class="p">)</span>
<span class="nf">abline</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="n">lwd</span> <span class="o">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">lty</span> <span class="o">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="m">4</span><span class="p">)</span>
<span class="n">par</span> <span class="o">=</span> <span class="n">pardef</span>
<span class="c1">#dev.off()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">'95% CI for the ATE: 0.255 +/- 0.041'</div><img alt="_images/09-grf_17_1.png" src="_images/09-grf_17_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># Train forest on school-wise DR scores</span>
<span class="c1">#</span>

<span class="n">school.X</span> <span class="o">=</span> <span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">school.mat</span><span class="p">)</span> <span class="o">%*%</span> <span class="nf">as.matrix</span><span class="p">(</span><span class="n">X</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="o">:</span><span class="m">8</span><span class="p">,</span> <span class="m">25</span><span class="o">:</span><span class="m">28</span><span class="p">)]))</span> <span class="o">/</span> <span class="n">school.size</span>
<span class="n">school.X</span> <span class="o">=</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">school.X</span><span class="p">)</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">school.X</span><span class="p">)</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;X1&quot;</span><span class="p">,</span> <span class="s">&quot;X2&quot;</span><span class="p">,</span> <span class="s">&quot;X3&quot;</span><span class="p">,</span> <span class="s">&quot;X4&quot;</span><span class="p">,</span> <span class="s">&quot;X5&quot;</span><span class="p">,</span>
                    <span class="s">&quot;XC.1&quot;</span><span class="p">,</span> <span class="s">&quot;XC.2&quot;</span><span class="p">,</span> <span class="s">&quot;XC.3&quot;</span><span class="p">,</span> <span class="s">&quot;XC.4&quot;</span><span class="p">)</span>

<span class="n">dr.score</span> <span class="o">=</span> <span class="n">tau.hat</span> <span class="o">+</span> <span class="n">W</span> <span class="o">/</span> <span class="n">cf</span><span class="o">$</span><span class="n">W.hat</span> <span class="o">*</span> <span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">cf</span><span class="o">$</span><span class="n">Y.hat</span> <span class="o">-</span> <span class="p">(</span><span class="m">1</span> <span class="o">-</span> <span class="n">cf</span><span class="o">$</span><span class="n">W.hat</span><span class="p">)</span> <span class="o">*</span> <span class="n">tau.hat</span><span class="p">)</span> <span class="o">-</span>
  <span class="p">(</span><span class="m">1</span> <span class="o">-</span> <span class="n">W</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="m">1</span> <span class="o">-</span> <span class="n">cf</span><span class="o">$</span><span class="n">W.hat</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">cf</span><span class="o">$</span><span class="n">Y.hat</span> <span class="o">+</span> <span class="n">cf</span><span class="o">$</span><span class="n">W.hat</span> <span class="o">*</span> <span class="n">tau.hat</span><span class="p">)</span>
<span class="n">school.score</span> <span class="o">=</span> <span class="nf">t</span><span class="p">(</span><span class="n">school.mat</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">dr.score</span> <span class="o">/</span> <span class="n">school.size</span>

<span class="n">school.forest</span> <span class="o">=</span> <span class="nf">regression_forest</span><span class="p">(</span><span class="n">school.X</span><span class="p">,</span> <span class="n">school.score</span><span class="p">)</span>
<span class="n">school.pred</span> <span class="o">=</span> <span class="nf">predict</span><span class="p">(</span><span class="n">school.forest</span><span class="p">)</span><span class="o">$</span><span class="n">predictions</span>
<span class="nf">test_calibration</span><span class="p">(</span><span class="n">school.forest</span><span class="p">)</span>


<span class="c1"># Alternative OLS analysis</span>
<span class="n">school.DF</span> <span class="o">=</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">school.X</span><span class="p">,</span> <span class="n">school.score</span><span class="o">=</span><span class="n">school.score</span><span class="p">)</span>
<span class="nf">coeftest</span><span class="p">(</span><span class="nf">lm</span><span class="p">(</span><span class="n">school.score</span> <span class="o">~</span> <span class="n">.</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">school.DF</span><span class="p">),</span> <span class="n">vcov</span> <span class="o">=</span> <span class="n">vcovHC</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best linear fit using forest predictions (on held-out data)
as well as the mean forest prediction as regressors, along
with one-sided heteroskedasticity-robust (HC3) SEs:

                               Estimate Std. Error t value Pr(&gt;t)    
mean.forest.prediction          1.00004    0.08179 12.2269 &lt;2e-16 ***
differential.forest.prediction  0.71717    0.67983  1.0549 0.1474    
---
Signif. codes:  0 â€˜***â€™ 0.001 â€˜**â€™ 0.01 â€˜*â€™ 0.05 â€˜.â€™ 0.1 â€˜ â€™ 1
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t test of coefficients:

              Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept)  0.2414116  0.0770612  3.1327 0.002583 **
X1          -0.0506340  0.0291568 -1.7366 0.087121 . 
X2           0.0125656  0.0336563  0.3734 0.710084   
X3           0.0102119  0.0266019  0.3839 0.702302   
X4           0.0236645  0.0255092  0.9277 0.356950   
X5          -0.0357828  0.0268560 -1.3324 0.187312   
XC.1         0.0015231  0.0935067  0.0163 0.987054   
XC.2         0.0887259  0.1047433  0.8471 0.400012   
XC.3        -0.1341513  0.0875327 -1.5326 0.130158   
XC.4         0.0424028  0.0816170  0.5195 0.605127   
---
Signif. codes:  0 â€˜***â€™ 0.001 â€˜**â€™ 0.01 â€˜*â€™ 0.05 â€˜.â€™ 0.1 â€˜ â€™ 1
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># Make some plots...</span>
<span class="c1">#</span>

<span class="c1">#pdf(&quot;tauhat_hist.pdf&quot;)</span>
<span class="n">pardef</span> <span class="o">=</span> <span class="nf">par</span><span class="p">(</span><span class="n">mar</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span> <span class="o">+</span> <span class="m">0.5</span><span class="p">,</span> <span class="n">cex.lab</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.axis</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.main</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.sub</span><span class="o">=</span><span class="m">1.5</span><span class="p">)</span>
<span class="nf">hist</span><span class="p">(</span><span class="n">tau.hat</span><span class="p">,</span> <span class="n">xlab</span> <span class="o">=</span> <span class="s">&quot;estimated CATE&quot;</span><span class="p">,</span> <span class="n">main</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="c1">#dev.off()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/09-grf_19_0.png" src="_images/09-grf_19_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#pdf(&quot;tauhat_hist_noprop.pdf&quot;)</span>
<span class="n">pardef</span> <span class="o">=</span> <span class="nf">par</span><span class="p">(</span><span class="n">mar</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span> <span class="o">+</span> <span class="m">0.5</span><span class="p">,</span> <span class="n">cex.lab</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.axis</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.main</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.sub</span><span class="o">=</span><span class="m">1.5</span><span class="p">)</span>
<span class="nf">hist</span><span class="p">(</span><span class="n">tau.hat.noprop</span><span class="p">,</span> <span class="n">xlab</span> <span class="o">=</span> <span class="s">&quot;estimated CATE&quot;</span><span class="p">,</span> <span class="n">main</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="c1">#dev.off()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/09-grf_20_0.png" src="_images/09-grf_20_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#pdf(&quot;tauhat_hist_noclust.pdf&quot;)</span>
<span class="n">pardef</span> <span class="o">=</span> <span class="nf">par</span><span class="p">(</span><span class="n">mar</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span> <span class="o">+</span> <span class="m">0.5</span><span class="p">,</span> <span class="n">cex.lab</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.axis</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.main</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.sub</span><span class="o">=</span><span class="m">1.5</span><span class="p">)</span>
<span class="nf">hist</span><span class="p">(</span><span class="n">tau.hat.noclust</span><span class="p">,</span> <span class="n">xlab</span> <span class="o">=</span> <span class="s">&quot;estimated CATE&quot;</span><span class="p">,</span> <span class="n">main</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
     <span class="n">breaks</span> <span class="o">=</span> <span class="nf">seq</span><span class="p">(</span><span class="m">-0.0</span><span class="p">,</span> <span class="m">0.55</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="m">0.55</span> <span class="o">/</span> <span class="m">25</span><span class="p">))</span>
<span class="c1">#dev.off()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/09-grf_21_0.png" src="_images/09-grf_21_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#pdf(&quot;tauhat_vs_X1.pdf&quot;)</span>
<span class="n">pardef</span> <span class="o">=</span> <span class="nf">par</span><span class="p">(</span><span class="n">mar</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span> <span class="o">+</span> <span class="m">0.5</span><span class="p">,</span> <span class="n">cex.lab</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.axis</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.main</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.sub</span><span class="o">=</span><span class="m">1.5</span><span class="p">)</span>
<span class="nf">boxplot</span><span class="p">(</span><span class="n">tau.hat</span> <span class="o">~</span> <span class="nf">round</span><span class="p">(</span><span class="n">X</span><span class="o">$</span><span class="n">X1</span><span class="p">),</span> <span class="n">xlab</span> <span class="o">=</span> <span class="s">&quot;X1&quot;</span><span class="p">,</span> <span class="n">ylab</span> <span class="o">=</span> <span class="s">&quot;estimated CATE&quot;</span><span class="p">)</span>
<span class="nf">lines</span><span class="p">(</span><span class="nf">smooth.spline</span><span class="p">(</span><span class="m">4</span> <span class="o">+</span> <span class="n">X</span><span class="p">[,</span><span class="s">&quot;X1&quot;</span><span class="p">],</span> <span class="n">tau.hat</span><span class="p">,</span> <span class="n">df</span> <span class="o">=</span> <span class="m">4</span><span class="p">),</span> <span class="n">lwd</span> <span class="o">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="m">4</span><span class="p">)</span>
<span class="c1">#dev.off()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/09-grf_22_0.png" src="_images/09-grf_22_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#pdf(&quot;tauhat_vs_X2.pdf&quot;)</span>
<span class="n">pardef</span> <span class="o">=</span> <span class="nf">par</span><span class="p">(</span><span class="n">mar</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span> <span class="o">+</span> <span class="m">0.5</span><span class="p">,</span> <span class="n">cex.lab</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.axis</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.main</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.sub</span><span class="o">=</span><span class="m">1.5</span><span class="p">)</span>
<span class="nf">boxplot</span><span class="p">(</span><span class="n">tau.hat</span> <span class="o">~</span> <span class="nf">round</span><span class="p">(</span><span class="n">X</span><span class="o">$</span><span class="n">X2</span><span class="p">),</span> <span class="n">xlab</span> <span class="o">=</span> <span class="s">&quot;X2&quot;</span><span class="p">,</span> <span class="n">ylab</span> <span class="o">=</span> <span class="s">&quot;estimated CATE&quot;</span><span class="p">)</span>
<span class="nf">lines</span><span class="p">(</span><span class="nf">smooth.spline</span><span class="p">(</span><span class="m">4</span> <span class="o">+</span> <span class="n">X</span><span class="p">[,</span><span class="s">&quot;X2&quot;</span><span class="p">],</span> <span class="n">tau.hat</span><span class="p">,</span> <span class="n">df</span> <span class="o">=</span> <span class="m">4</span><span class="p">),</span> <span class="n">lwd</span> <span class="o">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="m">4</span><span class="p">)</span>
<span class="c1">#dev.off()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/09-grf_23_0.png" src="_images/09-grf_23_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">school.avg.tauhat</span> <span class="o">=</span> <span class="nf">t</span><span class="p">(</span><span class="n">school.mat</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">tau.hat</span> <span class="o">/</span> <span class="n">school.size</span>

<span class="c1">#pdf(&quot;school_avg.pdf&quot;)</span>
<span class="n">pardef</span> <span class="o">=</span> <span class="nf">par</span><span class="p">(</span><span class="n">mar</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span> <span class="o">+</span> <span class="m">0.5</span><span class="p">,</span> <span class="n">cex.lab</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.axis</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.main</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.sub</span><span class="o">=</span><span class="m">1.5</span><span class="p">)</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">school.avg.tauhat</span><span class="p">,</span> <span class="n">school.pred</span><span class="p">,</span> <span class="n">cex</span> <span class="o">=</span> <span class="m">1.5</span><span class="p">,</span>
     <span class="n">xlim</span> <span class="o">=</span> <span class="nf">range</span><span class="p">(</span><span class="n">school.avg.tauhat</span><span class="p">,</span> <span class="n">school.pred</span><span class="p">),</span>
     <span class="n">ylim</span> <span class="o">=</span> <span class="nf">range</span><span class="p">(</span><span class="n">school.avg.tauhat</span><span class="p">,</span> <span class="n">school.pred</span><span class="p">),</span>
     <span class="n">xlab</span> <span class="o">=</span> <span class="s">&quot;average CATE estimate in school&quot;</span><span class="p">,</span>
     <span class="n">ylab</span> <span class="o">=</span> <span class="s">&quot;school-wise forest predictions&quot;</span><span class="p">)</span>
<span class="nf">abline</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="n">lwd</span> <span class="o">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">lty</span> <span class="o">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="m">4</span><span class="p">)</span>
<span class="n">par</span> <span class="o">=</span> <span class="n">pardef</span>
<span class="c1">#dev.off()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/09-grf_24_0.png" src="_images/09-grf_24_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># Experiment with no orthogonalization</span>
<span class="c1">#</span>

<span class="n">n.synth</span> <span class="o">=</span> <span class="m">1000</span>
<span class="n">p.synth</span> <span class="o">=</span> <span class="m">10</span>
<span class="n">X.synth</span> <span class="o">=</span> <span class="nf">matrix</span><span class="p">(</span><span class="nf">rnorm</span><span class="p">(</span><span class="n">n.synth</span> <span class="o">*</span> <span class="n">p.synth</span><span class="p">),</span> <span class="n">n.synth</span><span class="p">,</span> <span class="n">p.synth</span><span class="p">)</span>
<span class="n">W.synth</span> <span class="o">=</span> <span class="nf">rbinom</span><span class="p">(</span><span class="n">n.synth</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span> <span class="o">/</span> <span class="p">(</span><span class="m">1</span> <span class="o">+</span> <span class="nf">exp</span><span class="p">(</span><span class="o">-</span><span class="n">X.synth</span><span class="p">[,</span><span class="m">1</span><span class="p">])))</span>
<span class="n">Y.synth</span> <span class="o">=</span> <span class="m">2</span> <span class="o">*</span> <span class="nf">rowMeans</span><span class="p">(</span><span class="n">X.synth</span><span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">])</span> <span class="o">+</span> <span class="nf">rnorm</span><span class="p">(</span><span class="n">n.synth</span><span class="p">)</span>

<span class="n">Y.forest.synth</span> <span class="o">=</span> <span class="nf">regression_forest</span><span class="p">(</span><span class="n">X.synth</span><span class="p">,</span> <span class="n">Y.synth</span><span class="p">)</span>
<span class="n">Y.hat.synth</span> <span class="o">=</span> <span class="nf">predict</span><span class="p">(</span><span class="n">Y.forest.synth</span><span class="p">)</span><span class="o">$</span><span class="n">predictions</span>
<span class="n">W.forest.synth</span> <span class="o">=</span> <span class="nf">regression_forest</span><span class="p">(</span><span class="n">X.synth</span><span class="p">,</span> <span class="n">W.synth</span><span class="p">)</span>
<span class="n">W.hat.synth</span> <span class="o">=</span> <span class="nf">predict</span><span class="p">(</span><span class="n">W.forest.synth</span><span class="p">)</span><span class="o">$</span><span class="n">predictions</span>

<span class="n">cf.synth</span> <span class="o">=</span> <span class="nf">causal_forest</span><span class="p">(</span><span class="n">X.synth</span><span class="p">,</span> <span class="n">Y.synth</span><span class="p">,</span> <span class="n">W.synth</span><span class="p">,</span>
                         <span class="n">Y.hat</span> <span class="o">=</span> <span class="n">Y.hat.synth</span><span class="p">,</span> <span class="n">W.hat</span> <span class="o">=</span> <span class="n">W.hat.synth</span><span class="p">)</span>
<span class="n">ATE.synth</span> <span class="o">=</span> <span class="nf">average_treatment_effect</span><span class="p">(</span><span class="n">cf.synth</span><span class="p">)</span>
<span class="nf">paste</span><span class="p">(</span><span class="s">&quot;95% CI for the ATE:&quot;</span><span class="p">,</span> <span class="nf">round</span><span class="p">(</span><span class="n">ATE.synth</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="m">3</span><span class="p">),</span>
      <span class="s">&quot;+/-&quot;</span><span class="p">,</span> <span class="nf">round</span><span class="p">(</span><span class="nf">qnorm</span><span class="p">(</span><span class="m">0.975</span><span class="p">)</span> <span class="o">*</span> <span class="n">ATE.synth</span><span class="p">[</span><span class="m">2</span><span class="p">],</span> <span class="m">3</span><span class="p">))</span>

<span class="n">cf.synth.noprop</span> <span class="o">=</span> <span class="nf">causal_forest</span><span class="p">(</span><span class="n">X.synth</span><span class="p">,</span> <span class="n">Y.synth</span><span class="p">,</span> <span class="n">W.synth</span><span class="p">,</span>
                                <span class="n">Y.hat</span> <span class="o">=</span> <span class="n">Y.hat.synth</span><span class="p">,</span> <span class="n">W.hat</span> <span class="o">=</span> <span class="nf">mean</span><span class="p">(</span><span class="n">W.synth</span><span class="p">))</span>
<span class="n">ATE.synth.noprop</span> <span class="o">=</span> <span class="nf">average_treatment_effect</span><span class="p">(</span><span class="n">cf.synth.noprop</span><span class="p">)</span>
<span class="nf">paste</span><span class="p">(</span><span class="s">&quot;95% CI for the ATE:&quot;</span><span class="p">,</span> <span class="nf">round</span><span class="p">(</span><span class="n">ATE.synth.noprop</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="m">3</span><span class="p">),</span>
      <span class="s">&quot;+/-&quot;</span><span class="p">,</span> <span class="nf">round</span><span class="p">(</span><span class="nf">qnorm</span><span class="p">(</span><span class="m">0.975</span><span class="p">)</span> <span class="o">*</span> <span class="n">ATE.synth.noprop</span><span class="p">[</span><span class="m">2</span><span class="p">],</span> <span class="m">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">'95% CI for the ATE: 0.01 +/- 0.15'</div><div class="output text_html">'95% CI for the ATE: 0.13 +/- 0.137'</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># Visualize school-level covariates by treatment heterogeneity</span>
<span class="c1">#</span>

<span class="n">school.X.std</span> <span class="o">=</span> <span class="nf">scale</span><span class="p">(</span><span class="n">school.X</span><span class="p">)</span>
<span class="n">school.tercile</span> <span class="o">=</span> <span class="nf">cut</span><span class="p">(</span><span class="n">school.pred</span><span class="p">,</span>
                     <span class="n">breaks</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="o">-</span><span class="kc">Inf</span><span class="p">,</span> <span class="nf">quantile</span><span class="p">(</span><span class="n">school.pred</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="m">3</span><span class="p">,</span> <span class="m">2</span><span class="o">/</span><span class="m">3</span><span class="p">)),</span> <span class="kc">Inf</span><span class="p">))</span>
<span class="n">school.tercile.mat</span> <span class="o">=</span> <span class="nf">model.matrix</span><span class="p">(</span><span class="o">~</span> <span class="n">school.tercile</span> <span class="o">+</span> <span class="m">0</span><span class="p">)</span>
<span class="n">school.means</span> <span class="o">=</span> <span class="nf">diag</span><span class="p">(</span><span class="m">1</span> <span class="o">/</span> <span class="nf">colSums</span><span class="p">(</span><span class="n">school.tercile.mat</span><span class="p">))</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">school.tercile.mat</span><span class="p">)</span> <span class="o">%*%</span> <span class="nf">as.matrix</span><span class="p">(</span><span class="n">school.X.std</span><span class="p">)</span>

<span class="n">MM</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">school.means</span><span class="p">))</span>
<span class="n">HC</span> <span class="o">=</span> <span class="nf">heat.colors</span><span class="p">(</span><span class="m">21</span><span class="p">)</span>
<span class="n">school.col</span> <span class="o">=</span> <span class="nf">apply</span><span class="p">(</span><span class="n">school.means</span><span class="p">,</span> <span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">aa</span><span class="p">)</span> <span class="n">HC</span><span class="p">[</span><span class="m">1</span> <span class="o">+</span> <span class="nf">round</span><span class="p">(</span><span class="m">20</span> <span class="o">*</span> <span class="p">(</span><span class="m">0.5</span> <span class="o">+</span> <span class="n">aa</span><span class="p">))])</span>

<span class="n">DF.plot</span> <span class="o">=</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">tercile</span><span class="o">=</span><span class="nf">rep</span><span class="p">(</span><span class="nf">factor</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;low&quot;</span><span class="p">,</span> <span class="s">&quot;mid&quot;</span><span class="p">,</span> <span class="s">&quot;high&quot;</span><span class="p">)),</span> <span class="m">9</span><span class="p">),</span> <span class="n">mean</span><span class="o">=</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">school.means</span><span class="p">),</span>
                     <span class="n">feature</span> <span class="o">=</span> <span class="nf">factor</span><span class="p">(</span><span class="nf">rbind</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">school.X</span><span class="p">),</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">school.X</span><span class="p">),</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">school.X</span><span class="p">))))</span>

<span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">DF.plot</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">feature</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">tercile</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">mean</span><span class="p">))</span> <span class="o">+</span>
    <span class="nf">geom_tile</span><span class="p">()</span> <span class="o">+</span> <span class="nf">scale_fill_gradient</span><span class="p">(</span><span class="n">low</span> <span class="o">=</span> <span class="s">&quot;white&quot;</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="s">&quot;steelblue&quot;</span><span class="p">)</span> <span class="o">+</span>
    <span class="nf">theme</span><span class="p">(</span><span class="n">axis.text</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">12</span><span class="p">),</span> <span class="n">axis.title</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">14</span><span class="p">),</span>
          <span class="n">legend.title</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">14</span><span class="p">),</span> <span class="n">legend.text</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">12</span><span class="p">))</span> <span class="o">+</span>
    <span class="nf">theme</span><span class="p">(</span><span class="n">panel.background</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">())</span>
<span class="c1">#ggsave(&quot;tercile_plot.pdf&quot;, width = 8, height = 4.5, dpi = 120)</span>

<span class="nf">mean</span><span class="p">(</span><span class="n">school.X</span><span class="o">$</span><span class="n">XC.3</span><span class="p">)</span>
<span class="nf">mean</span><span class="p">(</span><span class="n">school.X</span><span class="o">$</span><span class="n">XC.3</span><span class="p">[</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">school.tercile</span><span class="p">)</span> <span class="o">==</span> <span class="m">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">0.210526315789474</div><div class="output text_html">0.538461538461538</div><img alt="_images/09-grf_26_2.png" src="_images/09-grf_26_2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># CATE by school</span>
<span class="c1">#</span>

<span class="n">ord</span> <span class="o">=</span> <span class="nf">order</span><span class="p">(</span><span class="nf">order</span><span class="p">(</span><span class="n">school.pred</span><span class="p">))</span>
<span class="n">school.sort</span> <span class="o">=</span> <span class="n">ord</span><span class="p">[</span><span class="n">school.id</span><span class="p">]</span>

<span class="c1">#pdf(&quot;school_boxplot.pdf&quot;)</span>
<span class="n">pardef</span> <span class="o">=</span> <span class="nf">par</span><span class="p">(</span><span class="n">mar</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span> <span class="o">+</span> <span class="m">0.5</span><span class="p">,</span> <span class="n">cex.lab</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.axis</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.main</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex.sub</span><span class="o">=</span><span class="m">1.5</span><span class="p">)</span>
<span class="nf">boxplot</span><span class="p">(</span><span class="n">tau.hat.noclust</span> <span class="o">~</span> <span class="n">school.sort</span><span class="p">,</span> <span class="n">xaxt</span> <span class="o">=</span> <span class="s">&quot;n&quot;</span><span class="p">,</span>
        <span class="n">xlab</span> <span class="o">=</span> <span class="s">&quot;school&quot;</span><span class="p">,</span> <span class="n">ylab</span> <span class="o">=</span> <span class="s">&quot;estimated CATE&quot;</span><span class="p">)</span>
<span class="nf">points</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">76</span><span class="p">,</span> <span class="nf">sort</span><span class="p">(</span><span class="n">school.pred</span><span class="p">),</span> <span class="n">col</span> <span class="o">=</span> <span class="m">4</span><span class="p">,</span> <span class="n">pch</span> <span class="o">=</span> <span class="m">16</span><span class="p">)</span>
<span class="nf">legend</span><span class="p">(</span><span class="s">&quot;topleft&quot;</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;school mean CATE&quot;</span><span class="p">,</span> <span class="s">&quot;CATE w/o clustering&quot;</span><span class="p">),</span> <span class="n">pch</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">16</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span> <span class="n">col</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span> <span class="n">cex</span> <span class="o">=</span> <span class="m">1.5</span><span class="p">)</span>
<span class="n">par</span> <span class="o">=</span> <span class="n">pardef</span>
<span class="c1">#dev.off()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/09-grf_27_0.png" src="_images/09-grf_27_0.png" />
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            kernelName: "ir",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="09-10-future-employment.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">The future of employment</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="09-11-neural-network-intro.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">ç¬¬ä¸ƒç«  ç¥ç»ç½‘ç»œä¸æ·±åº¦å­¦ä¹ </p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Cheng-Jun Wang<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>