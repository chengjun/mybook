
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è¯å‘é‡æ¨¡å‹ç®€ä»‹ &#8212; è®¡ç®—ä¼ æ’­å­¦</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Doc2Vec" href="10-doc2vec.html" />
    <link rel="prev" title="ç¬¬å…«ç«  æ–‡æœ¬æŒ–æ˜" href="10-text-minning-gov-report.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/socrates_jump.gif" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">è®¡ç®—ä¼ æ’­å­¦</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="index.html">
   å¯»æ‰¾äººç±»ä¼ æ’­è¡Œä¸ºçš„åŸºå› 
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="01-intro2cjc.html">
   ç¬¬ä¸€ç«  è®¡ç®—ä¼ æ’­å­¦ç®€ä»‹
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="02-bigdata.html">
     æ•°æ®ç§‘å­¦çš„ç¼–ç¨‹å·¥å…·ï¼šå¤§æ•°æ®
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="03-python-intro.html">
   ç¬¬äºŒç«  æ•°æ®ç§‘å­¦çš„ç¼–ç¨‹å·¥å…·
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="0-jupyter-notebook.html">
     Jupyter Notebook
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="0-slides.html">
     ä½¿ç”¨Jupyteråˆ¶ä½œSlidesçš„ä»‹ç»
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="0-turicreate.html">
     Turicreate: Departure from Graphlab
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="0-matplotlib-chinese.html">
     è§£å†³Matplotlibç»˜å›¾æ˜¾ç¤ºä¸­æ–‡é—®é¢˜
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03-UK-MPS-Scandal.html">
     æ¡ˆä¾‹ï¼š2009å¹´è‹±å›½å›½ä¼šè®®å‘˜å¼€æ”¯ä¸‘é—»
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03-umbrella-of-love.html">
     æ¡ˆä¾‹ï¼šã€Šè½¬è§’é‡åˆ°çˆ±ã€‹èƒŒåçš„æ•°æ®
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03-who-runs-China.html">
     æ¡ˆä¾‹ï¼šWho runs Chinaï¼ŸèƒŒåçš„æ•°æ®
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="04-crawler-beautifulsoup.html">
   ç¬¬ä¸‰ç«  æ•°æ®æŠ“å–
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="04-crawler-fact-checking.html">
     æŠ“å–å®æ—¶è¾Ÿè°£æ•°æ®
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04-crawler-13chambers.html">
     æŠ“å–ç½‘ç»œå°è¯´
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04-crawler-wechat.html">
     æŠ“å–å¾®ä¿¡å…¬ä¼—å·æ–‡ç« å†…å®¹
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04-crawler-douban.html">
     ä½¿ç”¨requests + XpathæŠ“å–è±†ç“£ç”µå½±æ•°æ®
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04-crawler-gov-report.html">
     æŠ“å–å†å±Šæ”¿åºœå·¥ä½œæŠ¥å‘Š
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04-crawler-cppcc.html">
     æŠ“å–æ±Ÿè‹çœæ”¿ååå¹´ææ¡ˆ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04-crawler-netease-music.html">
     æŠ“å–ç½‘æ˜“äº‘éŸ³ä¹çƒ­é—¨è¯„è®º
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04-crawler-selenium.html">
     ä½¿ç”¨Seleniumæ“çºµæµè§ˆå™¨
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04-crawler-selenium-music-history.html">
     æŠ“å–ç½‘æ˜“äº‘éŸ³ä¹ç”¨æˆ·çš„å¬æ­Œè®°å½•
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04-crawler-selenium-people-com-search.html">
     ä½¿ç”¨Seleniumæå–äººæ°‘ç½‘æœç´¢æ•°æ®
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04-crawler-tripadvisor.html">
     ä½¿ç”¨SeleniumæŠ“å–TripAdvisorç”¨æˆ·è¯„è®º
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04-crawler-pyppeteer.html">
     ä½¿ç”¨Pyppeteerå®ç°å¼‚æ­¥æŠ“å–!
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="06-data-cleaning-intro.html">
   ç¬¬å››ç«  æ•°æ®æ¸…æ´—
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="06-data-cleaning-preprocessing.html">
     å¯¹å¤§æ•°æ®è¿›è¡Œé¢„å¤„ç†
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06-data-cleaning-tweets.html">
     æ•°æ®æ¸…æ´—ä¹‹æ¨ç‰¹æ•°æ®
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06-data-cleaning-occupy-central-news.html">
     å¯¹å ä¸­æ–°é—»è¿›è¡Œæ•°æ®æ¸…æ´—
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06-data-cleaning-music-list.html">
     æ¸…æ´—éŸ³ä¹åˆ—è¡¨ğŸµ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06-data-cleaning-pandas.html">
     ä½¿ç”¨Pandasè¿›è¡Œæ•°æ®æ¸…æ´—
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="08-01-statistics-thinking.html">
   ç¬¬äº”ç«  ç»Ÿè®¡æ€ç»´
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="08-02-kl-divergence.html">
     KL Divergence
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-02-linear-algebra.html">
     Linear algebra
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-03-distributions.html">
     Distribution Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-03-probability.html">
     Probability
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-04-hypothesis-inference.html">
     Statistical Hypothesis Testing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-05-gradient-descent.html">
     Introduction to Gradient Descent
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-06-regression.html">
     Linear Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-06-statsmodels.html">
     Statistical Modeling with Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-07-analyzing-titanic-dataset.html">
     Logistic Regression of Titanic Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-07-covid19-pew-survey.html">
     Analysing the Pew Survey Data of COVID19
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-08-covid19-grangercausality.html">
     ç¤¾äº¤åª’ä½“å¯ä»¥é¢„æµ‹æ–°å† ç–«æƒ…å—ï¼Ÿ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-09-survival-analysis.html">
     Survival Analysis with Python
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="09-01-machine-learning-with-sklearn.html">
   ç¬¬å…­ç«  ç¤¾ä¼šç§‘å­¦å®¶çš„æœºå™¨å­¦ä¹ 
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="09-03-hyperparameters-and-model-validation.html">
     Hyperparameters and Model Validation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09-04-feature-engineering.html">
     Feature Engineering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09-05-naive-bayes.html">
     In Depth: Naive Bayes Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09-06-linear-regression.html">
     In Depth: Linear Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09-07-support-vector-machines.html">
     In-Depth: Support Vector Machines
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09-08-random-forests.html">
     In-Depth: Decision Trees and Random Forests
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09-09-googleflustudy.html">
     Forecasting and nowcasting with Google Flu Trends
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09-10-future-employment.html">
     The future of employment
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09-grf.html">
     Causal Forests
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="09-11-neural-network-intro.html">
   ç¬¬ä¸ƒç«  ç¥ç»ç½‘ç»œä¸æ·±åº¦å­¦ä¹ 
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="09-13-cnn.html">
     Convolutional Networks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09-14-rnn.html">
     Sequnce Modeling: Recurrent and Recursive Nets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09-12-hand-written-digits.html">
     Recognizing Hand-Written Digits with Neural Networks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09-15-cifar10.html">
     ä½¿ç”¨CNNå¯¹CIFAR10å›¾åƒè¿›è¡Œåˆ†ç±»
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09-16-pytorch_vgg_pretrained.html">
     VGG16é¢„è®­ç»ƒæ¨¡å‹
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="10-text-minning-gov-report.html">
   ç¬¬å…«ç«  æ–‡æœ¬æŒ–æ˜
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     è¯å‘é‡æ¨¡å‹ç®€ä»‹
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="10-doc2vec.html">
     Doc2Vec
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="11-1-sentiment-analysis-with-dict.html">
     åŸºäºå­—å…¸çš„æƒ…æ„Ÿåˆ†æ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="11-2-emotion-dict.html">
     å¤§è¿ç†å·¥å¤§å­¦ä¸­æ–‡æƒ…æ„Ÿè¯æ±‡
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="11-3-NRC-Chinese-dict.html">
     åŸºäºNRCå­—å…¸çš„æƒ…æ„Ÿåˆ†æ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="11-3-textblob.html">
     åˆ©ç”¨textblobè¿›è¡Œæƒ…æ„Ÿåˆ†æ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="11-4-sentiment-classifier.html">
     åŸºäºæœºå™¨å­¦ä¹ çš„æƒ…æ„Ÿåˆ†æ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="11-5-LIWC.html">
     LIWC: Linguistic Inquiry and Word Count  analyzer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="12-topic-models-update.html">
     ä¸»é¢˜æ¨¡å‹ç®€ä»‹
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="12-topic-models-with-turicreate.html">
     ä½¿ç”¨Turicreateå»ºç«‹ä¸»é¢˜æ¨¡å‹
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="13-recsys-intro.html">
   ç¬¬ä¹ç«  æ¨èç³»ç»Ÿç®€ä»‹
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="13-recsys-latent-factor-model.html">
     Latent Factor Recommender System
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="13-recsys-intro-surprise.html">
     ä½¿ç”¨Surpriseæ„å»ºæ¨èç³»ç»Ÿ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="14-millionsong.html">
     ä½¿ç”¨Turicreateè¿›è¡ŒéŸ³ä¹æ¨è
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="14-movielens.html">
     ä½¿ç”¨Turicreateè¿›è¡Œç”µå½±æ¨è
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="15-network-science-intro.html">
   ç¬¬åç«  ç½‘ç»œç§‘å­¦ç®€ä»‹
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="16-network-science-models.html">
     ç½‘ç»œç§‘å­¦æ¨¡å‹
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="17-networkx.html">
     ä½¿ç”¨NetworkXåˆ†æç½‘ç»œ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="18-02-network-diffusion.html">
     Simulating Network Diffusion With NDlib
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="18-03-network-epidemics.html">
     Epidemics on Networks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="18-04-seir-hcd-model.html">
     SEIR-HCD Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="18-network-ergm-siena.html">
     Social Network Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="18-network-weibo-hot-search.html">
     å¾®åšçƒ­æœåˆ†æ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="18-network-analysis-of-tianya-bbs.html">
     å¤©æ¶¯è®ºå›çš„å›å¸–ç½‘ç»œåˆ†æ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="19-facebook-ego-netwrok-visualization.html">
     å¯è§†åŒ–Facebookç¤¾äº¤ç½‘ç»œ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="18-network-ecomplexity.html">
     Economic Complexity and Product Complexity
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="19-visualization-with-seaborn.html">
   ç¬¬åä¸€ç«  å¯è§†åŒ–
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="19-visualization-scientific-plot.html">
     Matplotlibçš„ç§‘å­¦ç»˜å›¾æ ·å¼
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="19-visualization-with-pyecharts.html">
     ä½¿ç”¨PyEchartsè¿›è¡Œå¯è§†åŒ–
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="19-visualization-plotly-express.html">
     Plotly Express in Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="19-visualization-maps-using-folium.html">
     ä½¿ç”¨foliumåšåœ°å›¾å¯è§†åŒ–
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="19-visualization-datashader.html">
     ä½¿ç”¨Datashaderå¯è§†åŒ–åœ°ç†ä¿¡æ¯
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="19-visualization-datapane.html">
     ä½¿ç”¨Datapaneåˆ¶ä½œæ•°æ®æŠ¥å‘Š
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Pantheon.html">
     ä¸‡ç¥æ®¿é¡¹ç›®ï¼ˆPantheon Projectï¼‰
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/10-word2vec.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/chengjun/mybook"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/chengjun/mybook/issues/new?title=Issue%20on%20page%20%2F10-word2vec.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/chengjun/mybook/main?urlpath=tree/10-word2vec.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/chengjun/mybook/blob/main/10-word2vec.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-geometry-of-culture">
   The Geometry of Culture
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#histwords">
   HistWords
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#word-embeddings-quantify-100-years-of-gender-and-ethnic-stereotypes">
   Word embeddings quantify 100 years of gender and ethnic stereotypes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-illustrated-word2vec">
   The Illustrated Word2vec
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#personality-embeddings">
   Personality Embeddings
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cosine-similarity">
   Cosine Similarity
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#word-embeddings">
   Word Embeddings
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#google-news-word2vec">
     Google News Word2Vec
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-neural-language-model">
   The neural language model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#language-model-training">
     Language Model Training
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#skip-gram">
     Skip-gram
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#negative-sampling">
     Negative Sampling
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#word2vec-training-process">
     Word2vec Training Process
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pytorch-word2vec">
   Pytorch word2vec
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ngram">
   NGramè¯å‘é‡æ¨¡å‹
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#gensim-word2vec">
   Gensim Word2vec
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="id1">
<h1>è¯å‘é‡æ¨¡å‹ç®€ä»‹<a class="headerlink" href="#id1" title="Permalink to this headline">Â¶</a></h1>
<p>Introduction to Word Embeddings: Analyzing Meaning through Word Embeddings</p>
<p><strong>Using vectors to represent things</strong></p>
<ul class="simple">
<li><p>one of the most fascinating ideas in machine learning.</p></li>
<li><p>Word2vec is a method to efficiently create word embeddings.</p>
<ul>
<li><p>Mikolov et al. (2013). <a class="reference external" href="https://arxiv.org/pdf/1301.3781.pdf">Efficient Estimation of Word Representations in Vector Space</a></p></li>
<li><p>Mikolov et al. (2013). <a class="reference external" href="https://arxiv.org/pdf/1310.4546.pdf">Distributed representations of words and phrases and their compositionality</a></p></li>
</ul>
</li>
</ul>
<div class="section" id="the-geometry-of-culture">
<h2>The Geometry of Culture<a class="headerlink" href="#the-geometry-of-culture" title="Permalink to this headline">Â¶</a></h2>
<p>Analyzing Meaning through Word Embeddings</p>
<p>Austin C. Kozlowski; Matt Taddy; James A. Evans</p>
<p>https://arxiv.org/abs/1803.09288</p>
<p>Word embeddings represent <strong>semantic relations</strong> between words as <strong>geometric relationships</strong> between vectors in a high-dimensional space, operationalizing a relational model of meaning consistent with contemporary theories of identity and culture.</p>
<ul class="simple">
<li><p>Dimensions induced by word differences (e.g. man - woman, rich - poor, black - white, liberal - conservative) in these vector spaces closely correspond to dimensions of cultural meaning,</p></li>
<li><p>Macro-cultural investigation with a longitudinal analysis of the coevolution of gender and class associations in the United States over the 20th century</p></li>
</ul>
<p>The success of these high-dimensional models motivates a move towards â€œhigh-dimensional theorizingâ€ of meanings, identities and cultural processes.</p>
<a class="reference internal image-reference" href="_images/gender_class.png"><img alt="_images/gender_class.png" src="_images/gender_class.png" style="width: 700px;" /></a>
</div>
<div class="section" id="histwords">
<h2>HistWords<a class="headerlink" href="#histwords" title="Permalink to this headline">Â¶</a></h2>
<p>HistWords is a collection of tools and datasets for analyzing language change using word vector embeddings.</p>
<ul class="simple">
<li><p>The goal of this project is to facilitate quantitative research in diachronic linguistics, history, and the digital humanities.</p></li>
<li><p>We used the historical word vectors in HistWords to study the semantic evolution of more than 30,000 words across 4 languages.</p></li>
<li><p>This study led us to propose two statistical laws that govern the evolution of word meaning</p></li>
</ul>
<p>https://nlp.stanford.edu/projects/histwords/</p>
<p>https://github.com/williamleif/histwords</p>
<p><strong>Diachronic Word Embeddings Reveal Statistical Laws of Semantic Change</strong></p>
<a class="reference internal image-reference" href="_images/wordpaths-final.png"><img alt="_images/wordpaths-final.png" src="_images/wordpaths-final.png" style="width: 900px;" /></a>
</div>
<div class="section" id="word-embeddings-quantify-100-years-of-gender-and-ethnic-stereotypes">
<h2>Word embeddings quantify 100 years of gender and ethnic stereotypes<a class="headerlink" href="#word-embeddings-quantify-100-years-of-gender-and-ethnic-stereotypes" title="Permalink to this headline">Â¶</a></h2>
<p>http://www.pnas.org/content/early/2018/03/30/1720347115</p>
<a class="reference internal image-reference" href="_images/sex.png"><img alt="_images/sex.png" src="_images/sex.png" style="width: 500px;" /></a>
</div>
<div class="section" id="the-illustrated-word2vec">
<h2>The Illustrated Word2vec<a class="headerlink" href="#the-illustrated-word2vec" title="Permalink to this headline">Â¶</a></h2>
<p>Jay Alammar.  https://jalammar.github.io/illustrated-word2vec/</p>
</div>
<div class="section" id="personality-embeddings">
<h2>Personality Embeddings<a class="headerlink" href="#personality-embeddings" title="Permalink to this headline">Â¶</a></h2>
<blockquote>
<div><p>What are you like?</p>
</div></blockquote>
<p><strong>Big Five personality traits</strong>: openness to experience, conscientiousness, extraversion, agreeableness, and neuroticism</p>
<ul class="simple">
<li><p>the five-factor model (FFM)</p></li>
<li><p><strong>the OCEAN model</strong></p></li>
</ul>
<ul class="simple">
<li><p>å¼€æ”¾æ€§ï¼ˆopennessï¼‰ï¼šå…·æœ‰æƒ³è±¡ã€å®¡ç¾ã€æƒ…æ„Ÿä¸°å¯Œã€æ±‚å¼‚ã€åˆ›é€ ã€æ™ºèƒ½ç­‰ç‰¹è´¨ã€‚</p></li>
<li><p>è´£ä»»å¿ƒï¼ˆconscientiousnessï¼‰ï¼šæ˜¾ç¤ºèƒœä»»ã€å…¬æ­£ã€æ¡ç†ã€å°½èŒã€æˆå°±ã€è‡ªå¾‹ã€è°¨æ…ã€å…‹åˆ¶ç­‰ç‰¹ç‚¹ã€‚</p></li>
<li><p>å¤–å€¾æ€§ï¼ˆextraversionï¼‰ï¼šè¡¨ç°å‡ºçƒ­æƒ…ã€ç¤¾äº¤ã€æœæ–­ã€æ´»è·ƒã€å†’é™©ã€ä¹è§‚ç­‰ç‰¹è´¨ã€‚</p></li>
<li><p>å®œäººæ€§ï¼ˆagreeablenessï¼‰ï¼šå…·æœ‰ä¿¡ä»»ã€åˆ©ä»–ã€ç›´ç‡ã€ä¾ä»ã€è°¦è™šã€ç§»æƒ…ç­‰ç‰¹è´¨ã€‚</p></li>
<li><p>ç¥ç»è´¨æˆ–æƒ…ç»ªç¨³å®šæ€§ï¼ˆneuroticismï¼‰ï¼šå…·æœ‰å¹³è¡¡ç„¦è™‘ã€æ•Œå¯¹ã€å‹æŠ‘ã€è‡ªæˆ‘æ„è¯†ã€å†²åŠ¨ã€è„†å¼±ç­‰æƒ…ç»ªçš„ç‰¹è´¨ï¼Œå³å…·æœ‰ä¿æŒæƒ…ç»ªç¨³å®šçš„èƒ½åŠ›ã€‚</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Personality Embeddings: What are you like?</span>
<span class="n">jay</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]</span>
<span class="n">john</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">]</span>
<span class="n">mike</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="cosine-similarity">
<h2>Cosine Similarity<a class="headerlink" href="#cosine-similarity" title="Permalink to this headline">Â¶</a></h2>
<p>The cosine of two non-zero vectors can be derived by using the Euclidean dot product formula:</p>
<p>$$
\mathbf{A}\cdot\mathbf{B}
=\left|\mathbf{A}\right|\left|\mathbf{B}\right|\cos\theta
$$</p>
<p>$$
\text{similarity} = \cos(\theta) = {\mathbf{A} \cdot \mathbf{B} \over |\mathbf{A}| |\mathbf{B}|} = \frac{ \sum\limits_{i=1}^{n}{A_i  B_i} }{ \sqrt{\sum\limits_{i=1}^{n}{A_i^2}}  \sqrt{\sum\limits_{i=1}^{n}{B_i^2}} },
$$</p>
<p>where $A_i$ and $B_i$ are components of vector $A$ and $B$ respectively.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">dot</span>
<span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">norm</span>

<span class="k">def</span> <span class="nf">cos_sim</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">norm</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>

<span class="n">cos_sim</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.4999999999999999
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics.pairwise</span> <span class="kn">import</span> <span class="n">cosine_similarity</span>

<span class="n">cosine_similarity</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[-0.5]])
</pre></div>
</div>
</div>
</div>
<p>$$CosineDistance = 1- CosineSimilarity$$</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">spatial</span>
<span class="c1"># spatial.distance.cosine computes </span>
<span class="c1"># the Cosine distance between 1-D arrays.</span>
<span class="mi">1</span><span class="o">-</span><span class="n">spatial</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">cosine</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.5
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cos_sim</span><span class="p">(</span><span class="n">jay</span><span class="p">,</span> <span class="n">john</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6582337075311759
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cos_sim</span><span class="p">(</span><span class="n">jay</span><span class="p">,</span> <span class="n">mike</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.3683509554826695
</pre></div>
</div>
</div>
</div>
<p>Cosine similarity works for any number of dimensions.</p>
<ul class="simple">
<li><p>We can represent people (and things) as vectors of numbers (which is great for machines!).</p></li>
<li><p>We can easily calculate how similar vectors are to each other.</p></li>
</ul>
</div>
<div class="section" id="word-embeddings">
<h2>Word Embeddings<a class="headerlink" href="#word-embeddings" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="google-news-word2vec">
<h3>Google News Word2Vec<a class="headerlink" href="#google-news-word2vec" title="Permalink to this headline">Â¶</a></h3>
<p>You can download Googleâ€™s pre-trained model here.</p>
<ul class="simple">
<li><p>Itâ€™s 1.5GB!</p></li>
<li><p>It includes word vectors for a vocabulary of 3 million words and phrases</p></li>
<li><p>It is trained on roughly 100 billion words from a Google News dataset.</p></li>
<li><p>The vector length is 300 features.</p></li>
</ul>
<p>http://mccormickml.com/2016/04/12/googles-pretrained-word2vec-model-in-python/</p>
<p>Using the <strong>Gensim</strong> library in python, we can</p>
<ul class="simple">
<li><p>find the most similar words to the resulting vector.</p></li>
<li><p>add and subtract word vectors,</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gensim</span>
<span class="c1"># Load Google&#39;s pre-trained Word2Vec model.</span>
<span class="n">filepath</span> <span class="o">=</span> <span class="s1">&#39;/Users/datalab/bigdata/GoogleNews-vectors-negative300.bin&#39;</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">gensim</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">KeyedVectors</span><span class="o">.</span><span class="n">load_word2vec_format</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="p">[</span><span class="s1">&#39;woman&#39;</span><span class="p">][:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 0.24316406, -0.07714844, -0.10302734], dtype=float32)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">most_similar</span><span class="p">(</span><span class="s1">&#39;woman&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;man&#39;, 0.7664012312889099),
 (&#39;girl&#39;, 0.7494640946388245),
 (&#39;teenage_girl&#39;, 0.7336829900741577),
 (&#39;teenager&#39;, 0.631708562374115),
 (&#39;lady&#39;, 0.6288785934448242),
 (&#39;teenaged_girl&#39;, 0.6141784191131592),
 (&#39;mother&#39;, 0.607630729675293),
 (&#39;policewoman&#39;, 0.6069462299346924),
 (&#39;boy&#39;, 0.5975908041000366),
 (&#39;Woman&#39;, 0.5770983099937439)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">similarity</span><span class="p">(</span><span class="s1">&#39;woman&#39;</span><span class="p">,</span> <span class="s1">&#39;man&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.76640123
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cos_sim</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="s1">&#39;woman&#39;</span><span class="p">],</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;man&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.76640123
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">most_similar</span><span class="p">(</span><span class="n">positive</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;woman&#39;</span><span class="p">,</span> <span class="s1">&#39;king&#39;</span><span class="p">],</span> <span class="n">negative</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;man&#39;</span><span class="p">],</span> <span class="n">topn</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;queen&#39;, 0.7118192911148071),
 (&#39;monarch&#39;, 0.6189674139022827),
 (&#39;princess&#39;, 0.5902431607246399),
 (&#39;crown_prince&#39;, 0.5499460697174072),
 (&#39;prince&#39;, 0.5377321243286133)]
</pre></div>
</div>
</div>
</div>
<p>$$King- Queen = Man - Woman$$</p>
<a class="reference internal image-reference" href="_images/word2vec.png"><img alt="_images/word2vec.png" src="_images/word2vec.png" style="width: 700px;" /></a>
<p>Now that weâ€™ve looked at trained word embeddings,</p>
<ul class="simple">
<li><p>letâ€™s learn more about the training process.</p></li>
<li><p>But before we get to word2vec, we need to look at a conceptual parent of word embeddings: <strong>the neural language model</strong>.</p></li>
</ul>
</div>
</div>
<div class="section" id="the-neural-language-model">
<h2>The neural language model<a class="headerlink" href="#the-neural-language-model" title="Permalink to this headline">Â¶</a></h2>
<p>â€œYou shall know a word by the company it keepsâ€ J.R. Firth</p>
<blockquote>
<div><p>Bengio 2003 A Neural Probabilistic Language Model. Journal of Machine Learning Research. 3:1137â€“1155</p>
</div></blockquote>
<p>After being trained, early neural language models (Bengio 2003) would calculate a prediction in three steps:</p>
<a class="reference internal image-reference" href="_images/neural-language-model-prediction.png"><img alt="_images/neural-language-model-prediction.png" src="_images/neural-language-model-prediction.png" style="width: 700px;" /></a>
<a class="reference internal image-reference" href="_images/bengio.png"><img alt="_images/bengio.png" src="_images/bengio.png" style="width: 400px;" /></a>
<p>The output of the neural language model is a probability score for all the words the model knows.</p>
<ul class="simple">
<li><p>Weâ€™re referring to the probability as a percentage here,</p></li>
<li><p>but 40% would actually be represented as 0.4 in the output vector.</p></li>
</ul>
<div class="section" id="language-model-training">
<h3>Language Model Training<a class="headerlink" href="#language-model-training" title="Permalink to this headline">Â¶</a></h3>
<ul class="simple">
<li><p>We get a lot of text data (say, all Wikipedia articles, for example). then</p></li>
<li><p>We have a window (say, of three words) that we slide against all of that text.</p></li>
<li><p>The sliding window generates training samples for our model</p></li>
</ul>
<a class="reference internal image-reference" href="_images/lm-sliding-window-4.png"><img alt="_images/lm-sliding-window-4.png" src="_images/lm-sliding-window-4.png" style="width: 700px;" /></a>
<p>As this window slides against the text, we (virtually) generate a dataset that we use to train a model.</p>
<p>Instead of only looking two words before the target word, we can also look at two words after it.</p>
<a class="reference internal image-reference" href="_images/continuous-bag-of-words-example.png"><img alt="_images/continuous-bag-of-words-example.png" src="_images/continuous-bag-of-words-example.png" style="width: 700px;" /></a>
<p>If we do this, the dataset weâ€™re virtually building and training the model against would look like this:</p>
<a class="reference internal image-reference" href="_images/continuous-bag-of-words-dataset.png"><img alt="_images/continuous-bag-of-words-dataset.png" src="_images/continuous-bag-of-words-dataset.png" style="width: 700px;" /></a>
<p>This is called a <strong>Continuous Bag of Words</strong> (CBOW) https://arxiv.org/pdf/1301.3781.pdf</p>
</div>
<div class="section" id="skip-gram">
<h3>Skip-gram<a class="headerlink" href="#skip-gram" title="Permalink to this headline">Â¶</a></h3>
<p>Instead of guessing a word based on its context (the words before and after it), this other architecture tries to guess neighboring words using the current word.</p>
<a class="reference internal image-reference" href="_images/skipgram.png"><img alt="_images/skipgram.png" src="_images/skipgram.png" style="width: 700px;" /></a>
<p>https://arxiv.org/pdf/1301.3781.pdf</p>
<a class="reference internal image-reference" href="_images/cbow.png"><img alt="_images/cbow.png" src="_images/cbow.png" style="width: 700px;" /></a>
<a class="reference internal image-reference" href="_images/skipgram-sliding-window-samples.png"><img alt="_images/skipgram-sliding-window-samples.png" src="_images/skipgram-sliding-window-samples.png" style="width: 700px;" /></a>
<p>The pink boxes are in different shades because this sliding window actually creates four separate samples in our training dataset.</p>
<ul class="simple">
<li><p>We then slide our window to the next position:</p></li>
<li><p>Which generates our next four examples:</p></li>
</ul>
<a class="reference internal image-reference" href="_images/skipgram-language-model-training.png"><img alt="_images/skipgram-language-model-training.png" src="_images/skipgram-language-model-training.png" style="width: 700px;" /></a>
<a class="reference internal image-reference" href="_images/skipgram-language-model-training-4.png"><img alt="_images/skipgram-language-model-training-4.png" src="_images/skipgram-language-model-training-4.png" style="width: 700px;" /></a>
<a class="reference internal image-reference" href="_images/skipgram-language-model-training-5.png"><img alt="_images/skipgram-language-model-training-5.png" src="_images/skipgram-language-model-training-5.png" style="width: 700px;" /></a>
<a class="reference internal image-reference" href="_images/language-model-expensive.png"><img alt="_images/language-model-expensive.png" src="_images/language-model-expensive.png" style="width: 700px;" /></a>
</div>
<div class="section" id="negative-sampling">
<h3>Negative Sampling<a class="headerlink" href="#negative-sampling" title="Permalink to this headline">Â¶</a></h3>
<p>And switch it to a model that takes the input and output word, and outputs a score indicating <strong>if theyâ€™re neighbors or not</strong></p>
<ul class="simple">
<li><p>0 for â€œnot neighborsâ€, 1 for â€œneighborsâ€.</p></li>
</ul>
<a class="reference internal image-reference" href="_images/are-the-words-neighbors.png"><img alt="_images/are-the-words-neighbors.png" src="_images/are-the-words-neighbors.png" style="width: 700px;" /></a>
<a class="reference internal image-reference" href="_images/word2vec-negative-sampling-2.png"><img alt="_images/word2vec-negative-sampling-2.png" src="_images/word2vec-negative-sampling-2.png" style="width: 700px;" /></a>
<p>we need to introduce negative samples to our dataset</p>
<ul class="simple">
<li><p>samples of words that are not neighbors.</p></li>
<li><p>Our model needs to return 0 for those samples.</p></li>
<li><p>This leads to a great tradeoff of computational and statistical efficiency.</p></li>
</ul>
<p><strong>Skipgram with Negative Sampling (SGNS)</strong></p>
</div>
<div class="section" id="word2vec-training-process">
<h3>Word2vec Training Process<a class="headerlink" href="#word2vec-training-process" title="Permalink to this headline">Â¶</a></h3>
<a class="reference internal image-reference" href="_images/word2vec-training-update.png"><img alt="_images/word2vec-training-update.png" src="_images/word2vec-training-update.png" style="width: 700px;" /></a>
</div>
</div>
<div class="section" id="pytorch-word2vec">
<h2>Pytorch word2vec<a class="headerlink" href="#pytorch-word2vec" title="Permalink to this headline">Â¶</a></h2>
<p>https://github.com/jojonki/word2vec-pytorch/blob/master/word2vec.ipynb</p>
<p>https://github.com/bamtercelboo/pytorch_word2vec/blob/master/model.py</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># see http://pytorch.org/tutorials/beginner/nlp/word_embeddings_tutorial.html</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch.autograd</span> <span class="kn">import</span> <span class="n">Variable</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="k">as</span> <span class="nn">F</span>
<span class="kn">import</span> <span class="nn">torch.optim</span> <span class="k">as</span> <span class="nn">optim</span>

<span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;torch._C.Generator at 0x116c571d0&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;We are about to study the idea of a computational process.</span>
<span class="s2">Computational processes are abstract beings that inhabit computers.</span>
<span class="s2">As they evolve, processes manipulate other abstract things called data.</span>
<span class="s2">The evolution of a process is directed by a pattern of rules</span>
<span class="s2">called a program. People create programs to direct processes. In effect,</span>
<span class="s2">we conjure the spirits of the computer with our spells.&quot;&quot;&quot;</span>

<span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># By deriving a set from `raw_text`, we deduplicate the array</span>
<span class="n">vocab</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">vocab_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocab</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;vocab_size:&#39;</span><span class="p">,</span> <span class="n">vocab_size</span><span class="p">)</span>

<span class="n">w2i</span> <span class="o">=</span> <span class="p">{</span><span class="n">w</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vocab</span><span class="p">)}</span>
<span class="n">i2w</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">w</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vocab</span><span class="p">)}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>vocab_size: 44
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># context window size is two</span>
<span class="k">def</span> <span class="nf">create_cbow_dataset</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">[</span><span class="n">text</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">],</span> <span class="n">text</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                   <span class="n">text</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">text</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]]</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">context</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">data</span>

<span class="n">cbow_train</span> <span class="o">=</span> <span class="n">create_cbow_dataset</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cbow sample&#39;</span><span class="p">,</span> <span class="n">cbow_train</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>cbow sample ([&#39;we&#39;, &#39;are&#39;, &#39;to&#39;, &#39;study&#39;], &#39;about&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_skipgram_dataset</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">random</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
        <span class="c1"># negative sampling</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">rand_id</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rand_id</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">text</span><span class="p">[</span><span class="n">rand_id</span><span class="p">],</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">data</span>


<span class="n">skipgram_train</span> <span class="o">=</span> <span class="n">create_skipgram_dataset</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;skipgram sample&#39;</span><span class="p">,</span> <span class="n">skipgram_train</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>skipgram sample (&#39;about&#39;, &#39;we&#39;, 1)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CBOW</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vocab_size</span><span class="p">,</span> <span class="n">embd_size</span><span class="p">,</span> <span class="n">context_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CBOW</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">embd_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">context_size</span><span class="o">*</span><span class="n">embd_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_size</span><span class="p">,</span> <span class="n">vocab_size</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
        <span class="n">embedded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">hid</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linear1</span><span class="p">(</span><span class="n">embedded</span><span class="p">))</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear2</span><span class="p">(</span><span class="n">hid</span><span class="p">)</span>
        <span class="n">log_probs</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">log_softmax</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">log_probs</span>
    
    <span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
        <span class="n">embeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">embeds</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SkipGram</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vocab_size</span><span class="p">,</span> <span class="n">embd_size</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SkipGram</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">embd_size</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">focus</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="n">embed_focus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">(</span><span class="n">focus</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="c1"># input</span>
        <span class="n">embed_ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="c1"># output</span>
        <span class="n">score</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">embed_focus</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">embed_ctx</span><span class="p">))</span> <span class="c1"># input*output</span>
        <span class="n">log_probs</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">logsigmoid</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="c1"># sigmoid</span>
        <span class="k">return</span> <span class="n">log_probs</span>
    
    <span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">focus</span><span class="p">):</span>
        <span class="n">embed_focus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">(</span><span class="n">focus</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">embed_focus</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">torch.mm</span></code> Performs a matrix multiplication of the matrices</p>
<p><code class="docutils literal notranslate"><span class="pre">torch.t</span></code> Expects :attr:<code class="docutils literal notranslate"><span class="pre">input</span></code> to be a matrix (2-D tensor) and transposes dimensions 0
and 1. Can be seen as a short-hand function for <code class="docutils literal notranslate"><span class="pre">transpose(input,</span> <span class="pre">0,</span> <span class="pre">1)</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">embd_size</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="n">n_epoch</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">CONTEXT_SIZE</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># 2 words to the left, 2 to the right</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">train_cbow</span><span class="p">():</span>
    <span class="n">hidden_size</span> <span class="o">=</span> <span class="mi">64</span>
    <span class="n">losses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">loss_fn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">NLLLoss</span><span class="p">()</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">CBOW</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">embd_size</span><span class="p">,</span> <span class="n">CONTEXT_SIZE</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_epoch</span><span class="p">):</span>
        <span class="n">total_loss</span> <span class="o">=</span> <span class="mf">.0</span>
        <span class="k">for</span> <span class="n">context</span><span class="p">,</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">cbow_train</span><span class="p">:</span>
            <span class="n">ctx_idxs</span> <span class="o">=</span> <span class="p">[</span><span class="n">w2i</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">context</span><span class="p">]</span>
            <span class="n">ctx_var</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">(</span><span class="n">ctx_idxs</span><span class="p">))</span>

            <span class="n">model</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
            <span class="n">log_probs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">ctx_var</span><span class="p">)</span>

            <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_fn</span><span class="p">(</span><span class="n">log_probs</span><span class="p">,</span> <span class="n">Variable</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([</span><span class="n">w2i</span><span class="p">[</span><span class="n">target</span><span class="p">]])))</span>

            <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
            <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

            <span class="n">total_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="n">losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total_loss</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span><span class="p">,</span> <span class="n">losses</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">train_skipgram</span><span class="p">():</span>
    <span class="n">losses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">loss_fn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">SkipGram</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">embd_size</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_epoch</span><span class="p">):</span>
        <span class="n">total_loss</span> <span class="o">=</span> <span class="mf">.0</span>
        <span class="k">for</span> <span class="n">in_w</span><span class="p">,</span> <span class="n">out_w</span><span class="p">,</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">skipgram_train</span><span class="p">:</span>
            <span class="n">in_w_var</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([</span><span class="n">w2i</span><span class="p">[</span><span class="n">in_w</span><span class="p">]]))</span>
            <span class="n">out_w_var</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([</span><span class="n">w2i</span><span class="p">[</span><span class="n">out_w</span><span class="p">]]))</span>
            
            <span class="n">model</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
            <span class="n">log_probs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">in_w_var</span><span class="p">,</span> <span class="n">out_w_var</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_fn</span><span class="p">(</span><span class="n">log_probs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Variable</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="n">target</span><span class="p">])))</span>
            
            <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
            <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

            <span class="n">total_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="n">losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total_loss</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span><span class="p">,</span> <span class="n">losses</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cbow_model</span><span class="p">,</span> <span class="n">cbow_losses</span> <span class="o">=</span> <span class="n">train_cbow</span><span class="p">()</span>
<span class="n">sg_model</span><span class="p">,</span> <span class="n">sg_losses</span> <span class="o">=</span> <span class="n">train_skipgram</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CBOW(
  (embeddings): Embedding(44, 100)
  (linear1): Linear(in_features=400, out_features=64, bias=True)
  (linear2): Linear(in_features=64, out_features=44, bias=True)
)
SkipGram(
  (embeddings): Embedding(44, 100)
)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_epoch</span><span class="p">),</span> <span class="n">cbow_losses</span><span class="p">,</span> <span class="s1">&#39;r-o&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CBOW Losses&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_epoch</span><span class="p">),</span> <span class="n">sg_losses</span><span class="p">,</span> <span class="s1">&#39;g-s&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;SkipGram Losses&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10-word2vec_68_0.png" src="_images/10-word2vec_68_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cbow_vec</span> <span class="o">=</span> <span class="n">cbow_model</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">Variable</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">w2i</span><span class="o">.</span><span class="n">values</span><span class="p">()])))</span>
<span class="n">cbow_vec</span> <span class="o">=</span> <span class="n">cbow_vec</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<span class="nb">len</span><span class="p">(</span><span class="n">cbow_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sg_vec</span> <span class="o">=</span> <span class="n">sg_model</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">Variable</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">w2i</span><span class="o">.</span><span class="n">values</span><span class="p">()])))</span>
<span class="n">sg_vec</span> <span class="o">=</span> <span class="n">sg_vec</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<span class="nb">len</span><span class="p">(</span><span class="n">sg_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># åˆ©ç”¨PCAç®—æ³•è¿›è¡Œé™ç»´</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="n">X_reduced</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">sg_vec</span><span class="p">)</span>

<span class="c1"># ç»˜åˆ¶æ‰€æœ‰å•è¯å‘é‡çš„äºŒç»´ç©ºé—´æŠ•å½±</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X_reduced</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_reduced</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="c1"># ç»˜åˆ¶å‡ ä¸ªç‰¹æ®Šå•è¯çš„å‘é‡</span>
<span class="n">words</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">w2i</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="c1"># è®¾ç½®ä¸­æ–‡å­—ä½“ï¼Œå¦åˆ™æ— æ³•åœ¨å›¾å½¢ä¸Šæ˜¾ç¤ºä¸­æ–‡</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">w2i</span><span class="p">:</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">w2i</span><span class="p">[</span><span class="n">w</span><span class="p">]</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="n">X_reduced</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">w</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10-word2vec_71_0.png" src="_images/10-word2vec_71_0.png" />
</div>
</div>
</div>
<div class="section" id="ngram">
<h2>NGramè¯å‘é‡æ¨¡å‹<a class="headerlink" href="#ngram" title="Permalink to this headline">Â¶</a></h2>
<p>æœ¬æ–‡ä»¶æ˜¯é›†æ™ºAIå­¦å›­http://campus.swarma.org å‡ºå“çš„â€œç«ç‚¬ä¸Šçš„æ·±åº¦å­¦ä¹ â€ç¬¬VIè¯¾çš„é…å¥—æºä»£ç </p>
<p>åŸç†ï¼šåˆ©ç”¨ä¸€ä¸ªäººå·¥ç¥ç»ç½‘ç»œæ¥æ ¹æ®å‰Nä¸ªå•è¯æ¥é¢„æµ‹ä¸‹ä¸€ä¸ªå•è¯ï¼Œä»è€Œå¾—åˆ°æ¯ä¸ªå•è¯çš„è¯å‘é‡</p>
<p>ä»¥åˆ˜æ…ˆæ¬£è‘—åçš„ç§‘å¹»å°è¯´ã€Šä¸‰ä½“ã€‹ä¸ºä¾‹ï¼Œæ¥å±•ç¤ºåˆ©ç”¨NGramæ¨¡å‹è®­ç»ƒè¯å‘é‡çš„æ–¹æ³•</p>
<ul class="simple">
<li><p>é¢„å¤„ç†åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š1ã€è¯»å–æ–‡ä»¶ã€2ã€åˆ†è¯ã€3ã€å°†è¯­æ–™åˆ’åˆ†ä¸ºNï¼‹1å…ƒç»„ï¼Œå‡†å¤‡å¥½è®­ç»ƒç”¨æ•°æ®</p></li>
<li><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰å»é™¤æ ‡ç‚¹ç¬¦å·ï¼Œä¸€æ˜¯ä¸ºäº†ç¼–ç¨‹ç®€æ´ï¼Œè€Œæ˜¯è€ƒè™‘åˆ°åˆ†è¯ä¼šè‡ªåŠ¨å°†æ ‡ç‚¹ç¬¦å·å½“ä½œä¸€ä¸ªå•è¯å¤„ç†ï¼Œå› æ­¤ä¸éœ€è¦é¢å¤–è€ƒè™‘ã€‚</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../data/3body.txt&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">jieba</span><span class="o">,</span> <span class="nn">re</span>
<span class="n">temp</span> <span class="o">=</span> <span class="n">jieba</span><span class="o">.</span><span class="n">lcut</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">words</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">temp</span><span class="p">:</span>
    <span class="c1">#è¿‡æ»¤æ‰æ‰€æœ‰çš„æ ‡ç‚¹ç¬¦å·</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;[\s+\.\!\/_,$%^*(+</span><span class="se">\&quot;\&#39;</span><span class="s2">â€â€ã€Šã€‹]+|[+â€”â€”ï¼ï¼Œã€‚ï¼Ÿã€~@#ï¿¥%â€¦â€¦&amp;*ï¼ˆï¼‰ï¼š]+&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7754
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">text</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;å…«ä¸‡äº”åƒä¸‰ä½“æ—¶ï¼ˆçº¦8.6ä¸ªåœ°çƒå¹´ï¼‰åã€‚\n\nå…ƒé¦–ä¸‹ä»¤å¬å¼€ä¸‰ä½“ä¸–ç•Œå…¨ä½“æ‰§æ”¿å®˜ç´§æ€¥ä¼šè®®ï¼Œè¿™å¾ˆä¸å¯»å¸¸ï¼Œä¸€å®šæœ‰ä»€ä¹ˆé‡å¤§çš„äº‹ä»¶å‘ç”Ÿã€‚\n\nä¸¤ä¸‡ä¸‰ä½“æ—¶å‰ï¼Œä¸‰ä½“èˆ°é˜Ÿå¯èˆªäº†ï¼Œå®ƒä»¬åªçŸ¥é“ç›®æ ‡çš„å¤§è‡´æ–¹å‘ï¼Œå´ä¸çŸ¥é“å®ƒçš„è·ç¦»ã€‚ä¹Ÿ&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="n">words</span><span class="p">[:</span><span class="mi">50</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>å…«ä¸‡äº”åƒ ä¸‰ä½“ æ—¶ çº¦ 86 ä¸ª åœ°çƒ å¹´ å å…ƒé¦– ä¸‹ä»¤ å¬å¼€ ä¸‰ä½“ ä¸–ç•Œ å…¨ä½“ æ‰§æ”¿å®˜ ç´§æ€¥ä¼šè®® è¿™ å¾ˆ ä¸ å¯»å¸¸ ä¸€å®š æœ‰ ä»€ä¹ˆ é‡å¤§ çš„ äº‹ä»¶ å‘ç”Ÿ ä¸¤ä¸‡ ä¸‰ä½“ æ—¶å‰ ä¸‰ä½“ èˆ°é˜Ÿ å¯èˆª äº† å®ƒä»¬ åª çŸ¥é“ ç›®æ ‡ çš„ å¤§è‡´ æ–¹å‘ å´ ä¸ çŸ¥é“ å®ƒ çš„ è·ç¦» ä¹Ÿè®¸ ç›®æ ‡
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trigrams</span> <span class="o">=</span> <span class="p">[([</span><span class="n">words</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">words</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">words</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)]</span>
<span class="c1"># æ‰“å°å‡ºå‰ä¸‰ä¸ªå…ƒç´ çœ‹çœ‹</span>
<span class="nb">print</span><span class="p">(</span><span class="n">trigrams</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[([&#39;å…«ä¸‡äº”åƒ&#39;, &#39;ä¸‰ä½“&#39;], &#39;æ—¶&#39;), ([&#39;ä¸‰ä½“&#39;, &#39;æ—¶&#39;], &#39;çº¦&#39;), ([&#39;æ—¶&#39;, &#39;çº¦&#39;], &#39;86&#39;)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># å¾—åˆ°è¯æ±‡è¡¨</span>
<span class="n">vocab</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vocab</span><span class="p">))</span>
<span class="n">word_to_idx</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vocab</span><span class="p">)}</span> 
<span class="n">idx_to_word</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">i</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vocab</span><span class="p">)}</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
     <span class="n">word_to_idx</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span><span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2000
</pre></div>
</div>
</div>
</div>
<p>æ„é€ NGramç¥ç»ç½‘ç»œæ¨¡å‹ (ä¸‰å±‚çš„ç½‘ç»œ)</p>
<ol class="simple">
<li><p>è¾“å…¥å±‚ï¼šembeddingå±‚ï¼Œè¿™ä¸€å±‚çš„ä½œç”¨æ˜¯ï¼šå…ˆå°†è¾“å…¥å•è¯çš„ç¼–å·æ˜ å°„ä¸ºä¸€ä¸ªone hotç¼–ç çš„å‘é‡ï¼Œå½¢å¦‚ï¼š001000ï¼Œç»´åº¦ä¸ºå•è¯è¡¨å¤§å°ã€‚
ç„¶åï¼Œembeddingä¼šé€šè¿‡ä¸€ä¸ªçº¿æ€§çš„ç¥ç»ç½‘ç»œå±‚æ˜ å°„åˆ°è¿™ä¸ªè¯çš„å‘é‡è¡¨ç¤ºï¼Œè¾“å‡ºä¸ºembedding_dim</p></li>
<li><p>çº¿æ€§å±‚ï¼Œä»embedding_dimç»´åº¦åˆ°128ç»´åº¦ï¼Œç„¶åç»è¿‡éçº¿æ€§ReLUå‡½æ•°</p></li>
<li><p>çº¿æ€§å±‚ï¼šä»128ç»´åº¦åˆ°å•è¯è¡¨å¤§å°ç»´åº¦ï¼Œç„¶ålog softmaxå‡½æ•°ï¼Œç»™å‡ºé¢„æµ‹æ¯ä¸ªå•è¯çš„æ¦‚ç‡</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="k">as</span> <span class="nn">F</span>
<span class="kn">import</span> <span class="nn">torch.optim</span> <span class="k">as</span> <span class="nn">optim</span>
<span class="kn">from</span> <span class="nn">torch.autograd</span> <span class="kn">import</span> <span class="n">Variable</span>

<span class="kn">import</span> <span class="nn">torch</span>

<span class="k">class</span> <span class="nc">NGram</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vocab_size</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">,</span> <span class="n">context_size</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NGram</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">)</span>  <span class="c1">#åµŒå…¥å±‚</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">context_size</span> <span class="o">*</span> <span class="n">embedding_dim</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span> <span class="c1">#çº¿æ€§å±‚</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">vocab_size</span><span class="p">)</span> <span class="c1">#çº¿æ€§å±‚</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
        <span class="c1">#åµŒå…¥è¿ç®—ï¼ŒåµŒå…¥è¿ç®—åœ¨å†…éƒ¨åˆ†ä¸ºä¸¤æ­¥ï¼šå°†è¾“å…¥çš„å•è¯ç¼–ç æ˜ å°„ä¸ºone hotå‘é‡è¡¨ç¤ºï¼Œç„¶åç»è¿‡ä¸€ä¸ªçº¿æ€§å±‚å¾—åˆ°å•è¯çš„è¯å‘é‡</span>
        <span class="n">embeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># çº¿æ€§å±‚åŠ ReLU</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linear1</span><span class="p">(</span><span class="n">embeds</span><span class="p">))</span>
        
        <span class="c1"># çº¿æ€§å±‚åŠ Softmax</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear2</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">log_probs</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">log_softmax</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">log_probs</span>
    <span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
        <span class="n">embeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">embeds</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">losses</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#çºªå½•æ¯ä¸€æ­¥çš„æŸå¤±å‡½æ•°</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">NLLLoss</span><span class="p">()</span> <span class="c1">#è¿ç”¨è´Ÿå¯¹æ•°ä¼¼ç„¶å‡½æ•°ä½œä¸ºç›®æ ‡å‡½æ•°ï¼ˆå¸¸ç”¨äºå¤šåˆ†ç±»é—®é¢˜çš„ç›®æ ‡å‡½æ•°ï¼‰</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">NGram</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vocab</span><span class="p">),</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c1">#å®šä¹‰NGramæ¨¡å‹ï¼Œå‘é‡åµŒå…¥ç»´æ•°ä¸º10ç»´ï¼ŒNï¼ˆçª—å£å¤§å°ï¼‰ä¸º2</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span> <span class="c1">#ä½¿ç”¨éšæœºæ¢¯åº¦ä¸‹é™ç®—æ³•ä½œä¸ºä¼˜åŒ–å™¨ </span>
<span class="c1">#å¾ªç¯100ä¸ªå‘¨æœŸ</span>
<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">total_loss</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">context</span><span class="p">,</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">trigrams</span><span class="p">:</span>
        <span class="c1"># å‡†å¤‡å¥½è¾“å…¥æ¨¡å‹çš„æ•°æ®ï¼Œå°†è¯æ±‡æ˜ å°„ä¸ºç¼–ç </span>
        <span class="n">context_idxs</span> <span class="o">=</span> <span class="p">[</span><span class="n">word_to_idx</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">context</span><span class="p">]</span>
        <span class="c1"># åŒ…è£…æˆPyTorchçš„Variable</span>
        <span class="n">context_var</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">(</span><span class="n">context_idxs</span><span class="p">))</span>
        <span class="c1"># æ¸…ç©ºæ¢¯åº¦ï¼šæ³¨æ„PyTorchä¼šåœ¨è°ƒç”¨backwardçš„æ—¶å€™è‡ªåŠ¨ç§¯ç´¯æ¢¯åº¦ä¿¡æ¯ï¼Œæ•…è€Œæ¯éš”å‘¨æœŸè¦æ¸…ç©ºæ¢¯åº¦ä¿¡æ¯ä¸€æ¬¡ã€‚</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
        <span class="c1"># ç”¨ç¥ç»ç½‘ç»œåšè®¡ç®—ï¼Œè®¡ç®—å¾—åˆ°è¾“å‡ºçš„æ¯ä¸ªå•è¯çš„å¯èƒ½æ¦‚ç‡å¯¹æ•°å€¼</span>
        <span class="n">log_probs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">context_var</span><span class="p">)</span>
        <span class="c1"># è®¡ç®—æŸå¤±å‡½æ•°ï¼ŒåŒæ ·éœ€è¦æŠŠç›®æ ‡æ•°æ®è½¬åŒ–ä¸ºç¼–ç ï¼Œå¹¶åŒ…è£…ä¸ºVariable</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">log_probs</span><span class="p">,</span> <span class="n">Variable</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([</span><span class="n">word_to_idx</span><span class="p">[</span><span class="n">target</span><span class="p">][</span><span class="mi">0</span><span class="p">]])))</span>
        <span class="c1"># æ¢¯åº¦åä¼ </span>
        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
        <span class="c1"># å¯¹ç½‘ç»œè¿›è¡Œä¼˜åŒ–</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="c1"># ç´¯åŠ æŸå¤±å‡½æ•°å€¼</span>
        <span class="n">total_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">data</span>
    <span class="n">losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total_loss</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ç¬¬</span><span class="si">{}</span><span class="s1">è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š</span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">total_loss</span><span class="o">.</span><span class="n">numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ç¬¬0è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š56704.61
ç¬¬1è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š53935.28
ç¬¬2è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š52241.16
ç¬¬3è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š51008.51
ç¬¬4è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š50113.76
ç¬¬5è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š49434.07
ç¬¬6è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š48879.33
ç¬¬7è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š48404.71
ç¬¬8è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š47983.95
ç¬¬9è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š47600.01
ç¬¬10è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š47240.32
ç¬¬11è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š46897.53
ç¬¬12è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š46566.24
ç¬¬13è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š46241.59
ç¬¬14è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š45920.18
ç¬¬15è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š45599.50
ç¬¬16è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š45277.74
ç¬¬17è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š44953.10
ç¬¬18è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š44624.41
ç¬¬19è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š44290.34
ç¬¬20è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š43950.63
ç¬¬21è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š43604.48
ç¬¬22è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š43251.90
ç¬¬23è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š42891.99
ç¬¬24è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š42524.64
ç¬¬25è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š42149.46
ç¬¬26è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š41766.14
ç¬¬27è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š41374.89
ç¬¬28è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š40975.62
ç¬¬29è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š40568.36
ç¬¬30è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š40153.31
ç¬¬31è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š39730.61
ç¬¬32è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š39300.70
ç¬¬33è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š38863.39
ç¬¬34è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š38419.11
ç¬¬35è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š37968.16
ç¬¬36è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š37510.99
ç¬¬37è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š37048.06
ç¬¬38è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š36579.82
ç¬¬39è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š36106.78
ç¬¬40è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š35629.46
ç¬¬41è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š35148.57
ç¬¬42è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š34665.39
ç¬¬43è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š34180.25
ç¬¬44è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š33693.93
ç¬¬45è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š33207.48
ç¬¬46è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š32721.72
ç¬¬47è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š32237.36
ç¬¬48è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š31755.00
ç¬¬49è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š31275.05
ç¬¬50è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š30798.38
ç¬¬51è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š30325.62
ç¬¬52è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š29857.59
ç¬¬53è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š29394.65
ç¬¬54è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š28937.08
ç¬¬55è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š28485.72
ç¬¬56è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š28041.07
ç¬¬57è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š27603.33
ç¬¬58è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š27173.14
ç¬¬59è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š26750.82
ç¬¬60è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š26336.92
ç¬¬61è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š25931.60
ç¬¬62è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š25534.87
ç¬¬63è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š25147.07
ç¬¬64è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š24768.02
ç¬¬65è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š24397.92
ç¬¬66è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š24036.68
ç¬¬67è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š23684.69
ç¬¬68è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š23341.30
ç¬¬69è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š23006.46
ç¬¬70è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š22680.18
ç¬¬71è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š22361.95
ç¬¬72è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š22051.86
ç¬¬73è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š21749.46
ç¬¬74è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š21454.48
ç¬¬75è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š21167.06
ç¬¬76è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š20886.72
ç¬¬77è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š20613.04
ç¬¬78è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š20346.13
ç¬¬79è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š20085.52
ç¬¬80è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š19831.27
ç¬¬81è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š19583.16
ç¬¬82è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š19341.03
ç¬¬83è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š19104.43
ç¬¬84è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š18873.11
ç¬¬85è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š18646.91
ç¬¬86è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š18425.87
ç¬¬87è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š18209.80
ç¬¬88è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š17998.34
ç¬¬89è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š17791.97
ç¬¬90è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š17589.94
ç¬¬91è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š17392.24
ç¬¬92è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š17199.04
ç¬¬93è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š17009.97
ç¬¬94è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š16824.82
ç¬¬95è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š16643.87
ç¬¬96è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š16466.76
ç¬¬97è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š16293.54
ç¬¬98è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š16123.99
ç¬¬99è½®ï¼ŒæŸå¤±å‡½æ•°ä¸ºï¼š15957.75
</pre></div>
</div>
</div>
</div>
<p>12m 24s!!!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ä»è®­ç»ƒå¥½çš„æ¨¡å‹ä¸­æå–æ¯ä¸ªå•è¯çš„å‘é‡</span>
<span class="n">vec</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">Variable</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">word_to_idx</span><span class="o">.</span><span class="n">values</span><span class="p">()])))</span>
<span class="n">vec</span> <span class="o">=</span> <span class="n">vec</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

<span class="c1"># åˆ©ç”¨PCAç®—æ³•è¿›è¡Œé™ç»´</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="n">X_reduced</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ç»˜åˆ¶æ‰€æœ‰å•è¯å‘é‡çš„äºŒç»´ç©ºé—´æŠ•å½±</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X_reduced</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_reduced</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="c1"># ç»˜åˆ¶å‡ ä¸ªç‰¹æ®Šå•è¯çš„å‘é‡</span>
<span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;æ™ºå­&#39;</span><span class="p">,</span> <span class="s1">&#39;åœ°çƒ&#39;</span><span class="p">,</span> <span class="s1">&#39;ä¸‰ä½“&#39;</span><span class="p">,</span> <span class="s1">&#39;è´¨å­&#39;</span><span class="p">,</span> <span class="s1">&#39;ç§‘å­¦&#39;</span><span class="p">,</span> <span class="s1">&#39;ä¸–ç•Œ&#39;</span><span class="p">,</span> <span class="s1">&#39;æ–‡æ˜&#39;</span><span class="p">,</span> <span class="s1">&#39;å¤ªç©º&#39;</span><span class="p">,</span> <span class="s1">&#39;åŠ é€Ÿå™¨&#39;</span><span class="p">,</span> <span class="s1">&#39;å¹³é¢&#39;</span><span class="p">,</span> <span class="s1">&#39;å®‡å®™&#39;</span><span class="p">,</span> <span class="s1">&#39;ä¿¡æ¯&#39;</span><span class="p">]</span>
<span class="c1"># è®¾ç½®ä¸­æ–‡å­—ä½“ï¼Œå¦åˆ™æ— æ³•åœ¨å›¾å½¢ä¸Šæ˜¾ç¤ºä¸­æ–‡</span>
<span class="n">zhfont1</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">font_manager</span><span class="o">.</span><span class="n">FontProperties</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="s1">&#39;/Library/Fonts/åæ–‡ä»¿å®‹.ttf&#39;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">35</span><span class="p">)</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">word_to_idx</span><span class="p">:</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">word_to_idx</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="n">X_reduced</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">w</span><span class="p">,</span> <span class="n">fontproperties</span> <span class="o">=</span> <span class="n">zhfont1</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10-word2vec_84_0.png" src="_images/10-word2vec_84_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># å®šä¹‰è®¡ç®—cosineç›¸ä¼¼åº¦çš„å‡½æ•°</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="k">def</span> <span class="nf">cos_similarity</span><span class="p">(</span><span class="n">vec1</span><span class="p">,</span> <span class="n">vec2</span><span class="p">):</span>
    <span class="n">norm1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vec1</span><span class="p">)</span>
    <span class="n">norm2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vec2</span><span class="p">)</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">norm1</span> <span class="o">*</span> <span class="n">norm2</span>
    <span class="n">dot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vec1</span><span class="p">,</span> <span class="n">vec2</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">dot</span> <span class="o">/</span> <span class="n">norm</span> <span class="k">if</span> <span class="n">norm</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">result</span>
    
<span class="c1"># åœ¨æ‰€æœ‰çš„è¯å‘é‡ä¸­å¯»æ‰¾åˆ°ä¸ç›®æ ‡è¯ï¼ˆwordï¼‰ç›¸è¿‘çš„å‘é‡ï¼Œå¹¶æŒ‰ç›¸ä¼¼åº¦è¿›è¡Œæ’åˆ—</span>
<span class="k">def</span> <span class="nf">find_most_similar</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">vectors</span><span class="p">,</span> <span class="n">word_idx</span><span class="p">):</span>
    <span class="n">vector</span> <span class="o">=</span> <span class="n">vectors</span><span class="p">[</span><span class="n">word_to_idx</span><span class="p">[</span><span class="n">word</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">simi</span> <span class="o">=</span> <span class="p">[[</span><span class="n">cos_similarity</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">vectors</span><span class="p">[</span><span class="n">num</span><span class="p">]),</span> <span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">word_idx</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
    <span class="n">sort</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">simi</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sort</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">words</span>

<span class="c1"># ä¸æ™ºå­é è¿‘çš„è¯æ±‡</span>
<span class="n">find_most_similar</span><span class="p">(</span><span class="s1">&#39;æ™ºå­&#39;</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">word_to_idx</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;å±€éƒ¨&#39;, &#39;ä¸€åœº&#39;, &#39;æ¥&#39;, &#39;é”™è¯¯&#39;, &#39;ä¸€ç”Ÿ&#39;, &#39;æ­£ä¸­&#39;, &#39;èˆªè¡Œ&#39;, &#39;åœ°é¢&#39;, &#39;åªæ˜¯&#39;, &#39;æ”¿åºœ&#39;]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="gensim-word2vec">
<h2>Gensim Word2vec<a class="headerlink" href="#gensim-word2vec" title="Permalink to this headline">Â¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gensim</span> <span class="k">as</span> <span class="nn">gensim</span>
<span class="kn">from</span> <span class="nn">gensim.models</span> <span class="kn">import</span> <span class="n">Word2Vec</span>
<span class="kn">from</span> <span class="nn">gensim.models.keyedvectors</span> <span class="kn">import</span> <span class="n">KeyedVectors</span>
<span class="kn">from</span> <span class="nn">gensim.models.word2vec</span> <span class="kn">import</span> <span class="n">LineSentence</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;./data/ä¸‰ä½“.txt&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>

<span class="kn">import</span> <span class="nn">jieba</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">jieba</span><span class="o">.</span><span class="n">lcut</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="n">words</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">temp</span><span class="p">:</span>
        <span class="c1">#è¿‡æ»¤æ‰æ‰€æœ‰çš„æ ‡ç‚¹ç¬¦å·</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;[\s+\.\!\/_,$%^*(+</span><span class="se">\&quot;\&#39;</span><span class="s2">â€â€ã€Šã€‹]+|[+â€”â€”ï¼ï¼Œã€‚ï¼Ÿã€~@#ï¿¥%â€¦â€¦&amp;*ï¼ˆï¼‰ï¼šï¼›â€˜]+&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># è°ƒç”¨gensim Word2Vecçš„ç®—æ³•è¿›è¡Œè®­ç»ƒã€‚</span>
<span class="c1"># å‚æ•°åˆ†åˆ«ä¸ºï¼šsize: åµŒå…¥åçš„è¯å‘é‡ç»´åº¦ï¼›window: ä¸Šä¸‹æ–‡çš„å®½åº¦ï¼Œmin_countä¸ºè€ƒè™‘è®¡ç®—çš„å•è¯çš„æœ€ä½è¯é¢‘é˜ˆå€¼</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Word2Vec</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">window</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">,</span> <span class="n">min_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">wv</span><span class="o">.</span><span class="n">most_similar</span><span class="p">(</span><span class="s1">&#39;ä¸‰ä½“&#39;</span><span class="p">,</span> <span class="n">topn</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;å·&#39;, 0.9991474151611328),
 (&#39;ä»&#39;, 0.9990677237510681),
 (&#39;èƒŒæ™¯&#39;, 0.9989785552024841),
 (&#39;ä¸­&#39;, 0.9989073276519775),
 (&#39;å’Œ&#39;, 0.9988664388656616),
 (&#39;ä¸‹&#39;, 0.9988356232643127),
 (&#39;ä¸&#39;, 0.998835027217865),
 (&#39;æ—¶ä»£&#39;, 0.9988163709640503),
 (&#39;è¢«&#39;, 0.998814582824707),
 (&#39;ä¸Š&#39;, 0.9987987875938416),
 (&#39;è®¾å¤‡&#39;, 0.9987902641296387),
 (&#39;è¿™ä¸ª&#39;, 0.9987789392471313),
 (&#39;åœ¨&#39;, 0.9987666010856628),
 (&#39;å‡º&#39;, 0.998758852481842),
 (&#39;è®¡ç®—&#39;, 0.9987345337867737),
 (&#39;ç¡®å®&#39;, 0.9986939430236816),
 (&#39;åœ°çƒ&#39;, 0.9986928701400757),
 (&#39;å¼€å§‹&#39;, 0.9986846446990967),
 (&#39;ç ”ç©¶&#39;, 0.9986833930015564),
 (&#39;ç›®å‰&#39;, 0.9986788034439087),
 (&#39;è®¡ç®—æœº&#39;, 0.9986657500267029),
 (&#39;ä¸€ä¸ª&#39;, 0.9986624717712402),
 (&#39;ä½¿&#39;, 0.998661994934082),
 (&#39;çš„&#39;, 0.9986578226089478),
 (&#39;å‡ºç°&#39;, 0.9986552000045776),
 (&#39;çœŸå®&#39;, 0.9986495971679688),
 (&#39;ä¿¡æ¯&#39;, 0.9986458420753479),
 (&#39;é‚£æ ·&#39;, 0.9986419677734375),
 (&#39;æ¯ç­&#39;, 0.9986330270767212),
 (&#39;å­˜åœ¨&#39;, 0.9986319541931152),
 (&#39;ç”Ÿå‘½&#39;, 0.9986208081245422),
 (&#39;å¤ªé˜³&#39;, 0.9986128807067871),
 (&#39;å¤–æ˜Ÿ&#39;, 0.9986080527305603),
 (&#39;å®‡å®™&#39;, 0.9985974431037903),
 (&#39;æŠ€æœ¯&#39;, 0.9985949397087097),
 (&#39;å†…&#39;, 0.9985937476158142),
 (&#39;ä¸åŒ&#39;, 0.9985873699188232),
 (&#39;å¯¹&#39;, 0.9985859990119934),
 (&#39;â€™&#39;, 0.9985852241516113),
 (&#39;ä½†&#39;, 0.9985851645469666),
 (&#39;æˆ–&#39;, 0.998579740524292),
 (&#39;ä»¥&#39;, 0.9985793828964233),
 (&#39;ç¡®å®š&#39;, 0.9985712766647339),
 (&#39;å·²&#39;, 0.9985640048980713),
 (&#39;ç›‘å¬&#39;, 0.9985599517822266),
 (&#39;äº§ç”Ÿ&#39;, 0.9985580444335938),
 (&#39;ä¸€å&#39;, 0.998555064201355),
 (&#39;æ›¾&#39;, 0.9985499382019043),
 (&#39;æ§åˆ¶&#39;, 0.9985296726226807),
 (&#39;è´¨å­&#39;, 0.9985259771347046),
 (&#39;é‚£äº›&#39;, 0.9985222816467285),
 (&#39;å¯¹äº&#39;, 0.9985181093215942),
 (&#39;äºº&#39;, 0.9985091686248779),
 (&#39;å¾ˆ&#39;, 0.9984890222549438),
 (&#39;çŠ¶æ€&#39;, 0.9984877705574036),
 (&#39;å°†&#39;, 0.9984877705574036),
 (&#39;å…¶&#39;, 0.9984660744667053),
 (&#39;ç”šè‡³&#39;, 0.9984593987464905),
 (&#39;å¹¶&#39;, 0.998455286026001),
 (&#39;ä¸¤ä¸ª&#39;, 0.9984530806541443),
 (&#39;ä¸º&#39;, 0.9984517097473145),
 (&#39;ä¸€äº›&#39;, 0.9984512329101562),
 (&#39;åˆ°&#39;, 0.9984411597251892),
 (&#39;æ—¶&#39;, 0.9984337091445923),
 (&#39;æˆä¸º&#39;, 0.9984302520751953),
 (&#39;åªæœ‰&#39;, 0.9984236359596252),
 (&#39;äººç±»&#39;, 0.9984211325645447),
 (&#39;æ“ä½œ&#39;, 0.9984169006347656),
 (&#39;ä»¥å‰&#39;, 0.9984143972396851),
 (&#39;æœ‰&#39;, 0.998409628868103),
 (&#39;äº&#39;, 0.9984070062637329),
 (&#39;ç²¾ç¡®&#39;, 0.9984040260314941),
 (&#39;ææ–™&#39;, 0.9984034895896912),
 (&#39;å·¥ä½œ&#39;, 0.9984033107757568),
 (&#39;å‘å°„&#39;, 0.9983908534049988),
 (&#39;æ’å‡»&#39;, 0.9983891248703003),
 (&#39;å‘&#39;, 0.9983859062194824),
 (&#39;éœ€è¦&#39;, 0.9983782768249512),
 (&#39;é‡‘å­—å¡”&#39;, 0.9983758926391602),
 (&#39;å‘¨å›´&#39;, 0.9983750581741333),
 (&#39;è¿˜æœ‰&#39;, 0.9983642101287842),
 (&#39;è¿™ç§&#39;, 0.9983606338500977),
 (&#39;éƒ¨åˆ†&#39;, 0.998336911201477),
 (&#39;ä»&#39;, 0.9983317852020264),
 (&#39;äººä»¬&#39;, 0.9983276128768921),
 (&#39;ä¸‰ä¸ª&#39;, 0.9983229637145996),
 (&#39;å·²ç»&#39;, 0.9983162879943848),
 (&#39;å¤ªç©º&#39;, 0.9983103275299072),
 (&#39;å°&#39;, 0.9982970356941223),
 (&#39;åˆšåˆš&#39;, 0.998295783996582),
 (&#39;ä¸€ç‰‡&#39;, 0.9982841610908508),
 (&#39;ä¸€&#39;, 0.9982807636260986),
 (&#39;è¿˜æ˜¯&#39;, 0.9982765913009644),
 (&#39;å˜æˆ&#39;, 0.9982757568359375),
 (&#39;ç§‘å­¦&#39;, 0.9982727766036987),
 (&#39;ä¹Ÿ&#39;, 0.9982692003250122),
 (&#39;æœ€å&#39;, 0.9982669949531555),
 (&#39;ä¸€é¢—&#39;, 0.9982632398605347),
 (&#39;å…¶ä»–&#39;, 0.9982585906982422),
 (&#39;ä¸€ä¸‹&#39;, 0.9982539415359497)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># å°†è¯å‘é‡æŠ•å½±åˆ°äºŒç»´ç©ºé—´</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>

<span class="n">rawWordVec</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">word2ind</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">wv</span><span class="o">.</span><span class="n">vocab</span><span class="p">):</span>
    <span class="n">rawWordVec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="n">w</span><span class="p">])</span>
    <span class="n">word2ind</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
<span class="n">rawWordVec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rawWordVec</span><span class="p">)</span>
<span class="n">X_reduced</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">rawWordVec</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:8: DeprecationWarning: Call to deprecated `__getitem__` (Method will be removed in 4.0.0, use self.wv.__getitem__() instead).
  
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ç»˜åˆ¶æ˜Ÿç©ºå›¾</span>
<span class="c1"># ç»˜åˆ¶æ‰€æœ‰å•è¯å‘é‡çš„äºŒç»´ç©ºé—´æŠ•å½±</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X_reduced</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_reduced</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="c1"># ç»˜åˆ¶å‡ ä¸ªç‰¹æ®Šå•è¯çš„å‘é‡</span>
<span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;æ™ºå­&#39;</span><span class="p">,</span> <span class="s1">&#39;åœ°çƒ&#39;</span><span class="p">,</span> <span class="s1">&#39;ä¸‰ä½“&#39;</span><span class="p">,</span> <span class="s1">&#39;è´¨å­&#39;</span><span class="p">,</span> <span class="s1">&#39;ç§‘å­¦&#39;</span><span class="p">,</span> <span class="s1">&#39;ä¸–ç•Œ&#39;</span><span class="p">,</span> <span class="s1">&#39;æ–‡æ˜&#39;</span><span class="p">,</span> <span class="s1">&#39;å¤ªç©º&#39;</span><span class="p">,</span> <span class="s1">&#39;åŠ é€Ÿå™¨&#39;</span><span class="p">,</span> <span class="s1">&#39;å¹³é¢&#39;</span><span class="p">,</span> <span class="s1">&#39;å®‡å®™&#39;</span><span class="p">,</span> <span class="s1">&#39;è¿›å±•&#39;</span><span class="p">,</span><span class="s1">&#39;çš„&#39;</span><span class="p">]</span>
<span class="c1"># è®¾ç½®ä¸­æ–‡å­—ä½“ï¼Œå¦åˆ™æ— æ³•åœ¨å›¾å½¢ä¸Šæ˜¾ç¤ºä¸­æ–‡</span>
<span class="c1">#zhfont1 = matplotlib.font_manager.FontProperties(fname=&#39;/Library/Fonts/åæ–‡ä»¿å®‹.ttf&#39;, size=26)</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">word2ind</span><span class="p">:</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">word2ind</span><span class="p">[</span><span class="n">w</span><span class="p">]</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="n">X_reduced</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="c1">#plt.text(xy[0], xy[1], w, fontproperties = zhfont1, alpha = 1, color = &#39;yellow&#39;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">w</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10-word2vec_92_0.png" src="_images/10-word2vec_92_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ç»˜åˆ¶æ˜Ÿç©ºå›¾</span>
<span class="c1"># ç»˜åˆ¶æ‰€æœ‰å•è¯å‘é‡çš„äºŒç»´ç©ºé—´æŠ•å½±</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X_reduced</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_reduced</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="c1"># ç»˜åˆ¶å‡ ä¸ªç‰¹æ®Šå•è¯çš„å‘é‡</span>
<span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;æ™ºå­&#39;</span><span class="p">,</span> <span class="s1">&#39;åœ°çƒ&#39;</span><span class="p">,</span> <span class="s1">&#39;ä¸‰ä½“&#39;</span><span class="p">,</span> <span class="s1">&#39;è´¨å­&#39;</span><span class="p">,</span> <span class="s1">&#39;ç§‘å­¦&#39;</span><span class="p">,</span> <span class="s1">&#39;ä¸–ç•Œ&#39;</span><span class="p">,</span> <span class="s1">&#39;æ–‡æ˜&#39;</span><span class="p">,</span> <span class="s1">&#39;å¤ªç©º&#39;</span><span class="p">,</span> <span class="s1">&#39;åŠ é€Ÿå™¨&#39;</span><span class="p">,</span> <span class="s1">&#39;å¹³é¢&#39;</span><span class="p">,</span> <span class="s1">&#39;å®‡å®™&#39;</span><span class="p">,</span> <span class="s1">&#39;è¿›å±•&#39;</span><span class="p">,</span><span class="s1">&#39;çš„&#39;</span><span class="p">]</span>
<span class="c1"># è®¾ç½®ä¸­æ–‡å­—ä½“ï¼Œå¦åˆ™æ— æ³•åœ¨å›¾å½¢ä¸Šæ˜¾ç¤ºä¸­æ–‡</span>
<span class="n">zhfont1</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">font_manager</span><span class="o">.</span><span class="n">FontProperties</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="s1">&#39;/Library/Fonts/åæ–‡ä»¿å®‹.ttf&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">26</span><span class="p">)</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">word2ind</span><span class="p">:</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">word2ind</span><span class="p">[</span><span class="n">w</span><span class="p">]</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="n">X_reduced</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">w</span><span class="p">,</span> <span class="n">fontproperties</span> <span class="o">=</span> <span class="n">zhfont1</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;yellow&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10-word2vec_93_0.png" src="_images/10-word2vec_93_0.png" />
</div>
</div>
<p><img alt="" src="_images/end.png" /></p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="10-text-minning-gov-report.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">ç¬¬å…«ç«  æ–‡æœ¬æŒ–æ˜</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="10-doc2vec.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Doc2Vec</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Cheng-Jun Wang<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>